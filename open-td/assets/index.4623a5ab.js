var Mi=Object.defineProperty;var bi=(n,t,e)=>t in n?Mi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(bi(n,typeof t!="symbol"?t+"":t,e),e);import{H as _i,A as Ti,c as Ii,d as Z,a as S,b as _,g as w,t as R,h as D,i as Y,u as x,n as U,j as Rt,k as Ft,l as T,m as Bt,q as re,F as nt,s as Dt,v as C,w as vs,x as Ai,y as Ci,z as xi,B as ki,C as At,D as Pe,G as Pi,I as ge,J as pe,K as Di,L as Je}from"./vendor.d5be4d89.js";import{C as ut,S as Q,P as Me,A as Et,T as Es,G as Ss,L as Ri,s as Fi,a as Bi,b as Li,c as Yi,V as Xi}from"./pixi.cb0057c7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();let Oi=1;class V{constructor(t,e,s){r(this,"id");r(this,"rotation",0);this.x=t,this.y=e,this.agent=s,this.id=Oi++}getX(){return this.x}getAlignedX(){return this.x|0}getY(){return this.y}getAlignedY(){return this.y|0}getAgent(){return this.agent}getId(){return this.id}setX(t){this.x=t}setY(t){this.y=t}getRotation(){return this.rotation}setRotation(t){this.rotation=t}move(t,e,s){const i=(e.getX()-t.getX())*s+t.getX(),a=(e.getY()-t.getY())*s+t.getY();this.setX(i),this.setY(a),this.lookAt(e)}lookAt(t,e){let s,i;e!==void 0?(s=t-this.x,i=e-this.y):(s=t.getX()-this.x,i=t.getY()-this.y),(s||i)&&this.setRotation(Math.atan2(i,s)*180/Math.PI+90)}}const rt=n=>n.constructor.scale,gt=n=>{const t=rt(n),e=n.getTile();return[e.getX()+t/2,e.getY()+t/2]};function be(n){return n?"getTile"in n:!1}class B extends V{constructor(t,e,s){super(t,e,s)}getAgent(){return this.agent}}var M=(n=>(n[n.Unknown=0]="Unknown",n[n.Player=1]="Player",n[n.Enemy=2]="Enemy",n))(M||{}),h=(n=>(n[n.None=0]="None",n[n.Tower=1]="Tower",n[n.Slime=2]="Slime",n[n.Base=3]="Base",n[n.Bullet=4]="Bullet",n[n.Wall=5]="Wall",n[n.Mortar=6]="Mortar",n[n.Flamethrower=7]="Flamethrower",n[n.Flame=8]="Flame",n[n.Railgun=9]="Railgun",n[n.Rail=10]="Rail",n[n.ElectricFence=11]="ElectricFence",n[n.Fence=12]="Fence",n[n.Freezer=13]="Freezer",n[n.Tree=14]="Tree",n[n.Rock=15]="Rock",n[n.Radar=16]="Radar",n[n.PowerPlant=17]="PowerPlant",n[n.Blueprint=18]="Blueprint",n[n.Shockwave=19]="Shockwave",n[n.Armory=20]="Armory",n[n.Market=21]="Market",n[n.SpeedBeacon=22]="SpeedBeacon",n[n.Runner=23]="Runner",n[n.DamageBeacon=24]="DamageBeacon",n[n.Laser=25]="Laser",n[n.LaserBeam=26]="LaserBeam",n[n.Flier=27]="Flier",n[n.Tank=28]="Tank",n[n.Rocket=29]="Rocket",n[n.Excavator=30]="Excavator",n[n.Convert=31]="Convert",n[n.Terraform=32]="Terraform",n[n.EmergencyRecharge=33]="EmergencyRecharge",n[n.EmergencyRepair=34]="EmergencyRepair",n))(h||{});const De=new Set([3,16,17,20,21]),Ms=new Set([...De,1,6,7,9,14,15,22,24,25,5]);var L=(n=>(n[n.Undiscovered=0]="Undiscovered",n[n.Pending=1]="Pending",n[n.Discovered=2]="Discovered",n))(L||{}),d=(n=>(n[n.Void=0]="Void",n[n.Grass=1]="Grass",n[n.Stone=2]="Stone",n[n.Water=3]="Water",n[n.Obstructed=4]="Obstructed",n[n.Wall=5]="Wall",n[n.Spore=6]="Spore",n[n.ElectricFence=7]="ElectricFence",n[n.Fence=8]="Fence",n[n.Freezer=9]="Freezer",n[n.Bridge=10]="Bridge",n[n.Dirt=11]="Dirt",n[n.Snow=12]="Snow",n[n.Sand=13]="Sand",n[n.Ice=14]="Ice",n[n.PlayerBuilding=15]="PlayerBuilding",n[n.Tree=16]="Tree",n[n.Rock=17]="Rock",n[n.Base=18]="Base",n))(d||{});const Re=new Set([1,2,11,13,12]),Fe=new Set([...Re,3,14,10,16,17]),$i=new Set([...Fe,9,7,8]),Ni={[h.Tower]:4,[h.Wall]:5,[h.Mortar]:4,[h.Flamethrower]:4,[h.Railgun]:4,[h.ElectricFence]:7,[h.Fence]:8,[h.Freezer]:9,[h.Radar]:18,[h.PowerPlant]:18,[h.Tree]:16,[h.Rock]:17,[h.Armory]:18,[h.Base]:18,[h.Market]:18,[h.SpeedBeacon]:4,[h.DamageBeacon]:4,[h.Laser]:4};class z{constructor(t,e,s=d.Void){r(this,"staticEntity",null);r(this,"hash");r(this,"actualType");r(this,"towers",[]);r(this,"linkedAgents");r(this,"discoveryStatus",L.Undiscovered);this.x=t,this.y=e,this.type=s,this.hash=`[${this.x}, ${this.y}]`,this.actualType=s}getX(){return this.x}getY(){return this.y}getBaseType(){return this.type}getType(){return this.actualType}getStaticEntity(){return this.staticEntity}hasStaticEntity(){return this.staticEntity!==null}setStaticEntity(t){if(this.staticEntity!==null)throw new Error("A tile can only have 1 static entity.");const e=t.getAgent();be(e)&&e.getTile().getHash()===this.getHash()&&(e.updateTile(this),this.linkedAgents&&e.updateLinkedAgents&&e.updateLinkedAgents(this.linkedAgents)),this.staticEntity=t,this.actualType=Ni[t.getAgent().getType()]||this.type}clearStaticEntity(){this.staticEntity=null,this.actualType=this.type}isStaticEntityRoot(){var t;return((t=this.staticEntity)==null?void 0:t.getAgent().getTile())===this}addTower(t){this.towers.includes(t)||this.towers.push(t)}setDiscoveryStatus(t){this.discoveryStatus=t}isDiscovered(){return this.discoveryStatus===L.Discovered}getDiscoveryStatus(){return this.discoveryStatus}isCoveredByTower(){return this.isDiscovered()&&this.towers.length>0}removeTower(t){this.towers.splice(this.towers.indexOf(t),1)}getAvailableTowers(){return this.towers.filter(t=>t.getCooldown()<=0)}getTowers(){return this.towers}addLinkedAgent(t){var s;this.linkedAgents||(this.linkedAgents=new Set),this.linkedAgents.add(t);const e=(s=this.staticEntity)==null?void 0:s.getAgent();e&&e.updateLinkedAgents&&e.updateLinkedAgents(this.linkedAgents)}removeLinkedAgent(t){var s;if(!this.linkedAgents)return;this.linkedAgents.delete(t);const e=(s=this.staticEntity)==null?void 0:s.getAgent();be(e)&&e.updateLinkedAgents&&e.updateLinkedAgents(this.linkedAgents)}getLinkedAgents(){return this.linkedAgents}getHash(){return this.hash}sync(t){this.towers=t.towers,this.discoveryStatus=t.discoveryStatus}}const Lt=(n,t)=>{const e=[],s=rt(n),i=s===2?1:0;c.Instance.getSurface().forCircle(n.getTile().getX()+i,n.getTile().getY()+i,t*s,a=>{if(Fe.has(a.getBaseType())){a.hasStaticEntity()&&a.getStaticEntity().getAgent().category!==M.Player&&c.Instance.getSurface().despawnStatic(a.getStaticEntity().getAgent());const o=new z(a.getX(),a.getY(),d.Stone);e.push(o)}}),c.Instance.getSurface().setTiles(e)},bs=(n,t)=>(n%t+t)%t,wt=(n,t,e)=>n+(t-n)*e,Ui=(n,t,e)=>{if(n===t)return t;const s=bs(t-n+180,360)-180;return s<0?(n-Math.min(-s,e)+360)%360:n+Math.min(s,e)},Wi=.002;class Hi{constructor(t,e,s){r(this,"entity");r(this,"category",M.Unknown);r(this,"renderData",{});r(this,"time",0);r(this,"travelTime");this.tile=t,this.target=e,this.damage=s,this.entity=new V(t.getX()+.5,t.getY()+.5,this);const i=t.getX()-e.getX(),a=t.getY()-e.getY(),o=Math.sqrt(i*i+a*a);this.travelTime=o/Wi,this.time=this.travelTime/4,this.entity.lookAt(e)}tick(t){this.time>=this.travelTime&&(c.Instance.getSurface().despawn(this),[...c.Instance.getSurface().getEntitiesForCategory(M.Enemy)].filter(s=>s.getAlignedX()===this.target.getX()&&s.getAlignedY()===this.target.getY()).forEach(s=>{s.getAgent().AI.hit(this.damage)})),this.time=Math.min(this.time+t,this.travelTime);const e=this.time/this.travelTime;this.entity.setX(wt(this.tile.getX(),this.target.getX(),e)+.5),this.entity.setY(wt(this.tile.getY(),this.target.getY(),e)+.5)}getType(){return h.Shockwave}getTile(){return this.tile}isVisible(){return!0}}const ji=1e3,Vi=200,Gi=[[0,0],[1,0],[1,1],[0,1]],zi=[[[-1,0],[-1,-1],[0,-1]],[[0,-1],[1,-1],[1,0]],[[1,0],[1,1],[0,1]],[[0,1],[-1,1],[-1,0]]];class _s{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"hp",30);r(this,"invincibleTime",0);r(this,"renderData",{});r(this,"baseParts",new Set);r(this,"basePartsByType",new Map);this.tile=t,this.entity=new B(t.getX(),t.getY(),this),this.baseParts.add(this)}tick(t){this.invincibleTime=Math.max(0,this.invincibleTime-t)}getType(){return h.Base}getTile(){return this.tile}updateTile(t){this.tile=t}getHp(){return this.hp}spawn(){c.Instance.getVisibilityController().registerAgent(this),Lt(this,4)}despawn(){c.Instance.getVisibilityController().removeAgent(this)}hit(t){this.invincibleTime>0||this.hp<=0||(this.hp-=t,this.hp<=0?(c.Instance.showMessage("You lose!",{closable:!1}),c.Instance.getSurface().forceRerender()):(this.invincibleTime=ji,this.shockwave()),c.Instance.triggerStatUpdate())}regenerate(t=1){this.hp+=this.getRegenerationFactor()*t}isVisible(){return!0}isDestroyed(){return this.hp<=0}addPart(t){var e;this.baseParts.add(t),this.basePartsByType.set(t.getType(),((e=this.basePartsByType.get(t.getType()))!=null?e:0)+1)}removePart(t){this.baseParts.delete(t),this.basePartsByType.set(t.getType(),this.basePartsByType.get(t.getType())-1)}getParts(){return this.baseParts}getPartsCount(t){var e;return(e=this.basePartsByType.get(t))!=null?e:0}getRegenerationFactor(){const t=this.getPartsCount(h.Armory);return t*50/(t+25)}getMoneyFactor(){const t=this.getPartsCount(h.Market);return 1+t*2.5/(t+25)}shockwave(){const t=c.Instance.getSurface(),e=new Map;this.baseParts.forEach(s=>{Gi.forEach(([i,a],o)=>{const l=t.getTile(s.getTile().getX()+i,s.getTile().getY()+a);zi[o].forEach(([u,p])=>{const y=t.getTile(s.getTile().getX()+i+u,s.getTile().getY()+a+p);y&&!e.has(y.getHash())&&$i.has(y.getType())&&e.set(y.getHash(),[l,y])})})}),e.forEach(([s,i])=>{const a=new Hi(s,i,Vi);t.spawn(a)})}}r(_s,"scale",2);const fe=n=>n.getType()===h.Base;class Ki{constructor(t){r(this,"agents",new Set);r(this,"edgeMap",new Map);r(this,"pendingAgents",new Set);r(this,"base");r(this,"minX");r(this,"minY");r(this,"maxX");r(this,"maxY");this.surface=t}registerAgent(t){this.agents.add(t);let e=L.Pending;fe(t)?(this.base=t,e=L.Discovered):this.pendingAgents.add(t);const s=this.getVisibilityRange(t),i=this.getVisibilityEdge(t);this.edgeMap.set(t.entity.getId(),i),this.updateVisibility(...i,s,e)}removeAgent(t){if(!this.agents.has(t))return;fe(t)&&(this.base=void 0);const e=this.getVisibilityRange(t),s=this.edgeMap.get(t.entity.getId());this.surface.forCircle(...s,e,i=>i.setDiscoveryStatus(L.Undiscovered)),this.agents.delete(t),this.pendingAgents.delete(t),this.edgeMap.delete(t.entity.getId()),this.update()}commit(){this.pendingAgents.clear(),this.update()}update(){this.minX=void 0,this.minY=void 0,this.maxX=void 0,this.maxY=void 0,this.agents.forEach(t=>{const e=this.getVisibilityRange(t),s=this.edgeMap.get(t.entity.getId());this.surface.forCircle(...s,e,i=>i.setDiscoveryStatus(L.Undiscovered))}),this.agents.forEach(t=>{const e=this.pendingAgents.has(t)?L.Pending:L.Discovered,s=this.getVisibilityRange(t),i=this.getVisibilityEdge(t);this.edgeMap.set(t.entity.getId(),i),this.updateVisibility(...i,s,e)})}updateBaseRange(){if(!this.base)throw new Error("Updating base range without a base");const t=this.getVisibilityRange(this.base),e=this.getVisibilityEdge(this.base);this.edgeMap.set(this.base.entity.getId(),e),this.updateVisibility(...e,t,L.Pending)}getBBox(){return[[this.minX,this.minY],[this.maxX,this.maxY]]}hasPendingAgents(){return this.pendingAgents.size>0}getVisibilityRange(t){switch(t.getType()){case h.Base:return 35+c.Instance.getWaveController().getLevel()*2;case h.Radar:return 35;default:throw new Error("Entity has no visibility defined")}}getVisibilityEdge(t){if(fe(t)||!this.base)return[t.entity.getAlignedX(),t.entity.getAlignedY()];let e;const s=Math.atan2(t.entity.getAlignedY()-this.base.entity.getAlignedY(),t.entity.getAlignedX()-this.base.entity.getAlignedX());return this.surface.forRay(this.base.entity.getAlignedX(),this.base.entity.getAlignedY(),s,i=>i.getDiscoveryStatus()===L.Undiscovered?!1:(e=i,!0)),e?[e.getX(),e.getY()]:[t.entity.getAlignedX(),t.entity.getAlignedY()]}updateVisibility(t,e,s,i){(!this.minX||t-s/2<this.minX)&&(this.minX=t-s/2),(!this.minY||e-s/2<this.minY)&&(this.minY=e-s/2),(!this.maxX||t+s/2>this.maxX)&&(this.maxX=t+s/2),(!this.maxY||e+s/2>this.maxY)&&(this.maxY=e+s/2),this.surface.forCircle(t,e,s,a=>{i===L.Pending&&a.isDiscovered()||a.setDiscoveryStatus(i)})}}var k=(n=>(n[n.StatUpdate=0]="StatUpdate",n[n.SurfaceChange=1]="SurfaceChange",n[n.BlackOut=2]="BlackOut",n[n.OpenBuildMenu=3]="OpenBuildMenu",n[n.CloseBuildMenu=4]="CloseBuildMenu",n[n.ToggleShowCoverage=5]="ToggleShowCoverage",n[n.StartWave=6]="StartWave",n[n.EndWave=7]="EndWave",n[n.Unlock=8]="Unlock",n))(k||{}),$=(n=>(n.Easy="easy",n.Normal="normal",n.Hard="hard",n))($||{});const ts={easy:{label:"Easy",description:"Allows checking which tiles are covered by tower sight lines. Shows the approximate path enemies will take and undiscovered nests do not become stronger."},normal:{label:"Normal",description:"Allows checking which tiles are covered by tower sight lines. Enemies are a bit stronger and undiscovered nests slowly gain more strength."},hard:{label:"Hard",description:"Checking tower sight lines is no longer possible, enemies are stronger and undiscovered nests gain strength more quickly"}};class mt{constructor(t,e,s){this.min=t,this.max=e,this.unit=s}getRange(){return[this.min,this.max]}getCenter(){return(this.min+this.max)/2}getLength(){return this.max-this.min}getUnit(){return this.unit}equals(t){return this.min===t.min&&this.max===t.max}toString(){return`[${this.min}, ${this.max}]`}static forSpawnGroup(t){const[e,s]=t.getCenter(),i=c.Instance.getBase().getTile(),a=e-i.getX(),o=s-i.getY(),l=(Math.atan2(o,a)*180/Math.PI+360)%360;switch(c.Instance.getDifficulty()){case $.Easy:return new mt(Math.floor(l/15)*15,Math.floor(l/15)*15+15,t.getUnitType());case $.Normal:return new mt(Math.floor(l/45)*45,Math.floor(l/45)*45+45);case $.Hard:return new mt(Math.floor(l/120)*120,Math.floor(l/120)*120+120)}}static forSpawnGroups(t){const e=new Map;return t.filter(s=>!s.isExposed()).forEach(s=>{const i=mt.forSpawnGroup(s);e.set(i.toString(),i)}),[...e.values()]}}var P=(n=>(n[n.Normal=0]="Normal",n[n.OnFire=1]="OnFire",n))(P||{});class qi{constructor(t){r(this,"isBlocking",!0);this.index=t}isCleared(t){return!t[this.index].hasStaticEntity()}process(t,e,s){e.AI.attack(t[this.index].getStaticEntity().getAgent())}}const ae=(n=Ms)=>t=>{const e=[];return t.forEach((s,i)=>{s.hasStaticEntity()&&n.has(s.getStaticEntity().getAgent().getType())&&e.push(new qi(i))}),e},es=(n,t)=>({...n,...t}),oe={[d.Grass]:3,[d.Water]:20,[d.Stone]:4,[d.Wall]:3,[d.Spore]:2,[d.ElectricFence]:5,[d.Fence]:20,[d.Freezer]:6,[d.Obstructed]:3,[d.Bridge]:5,[d.Dirt]:2.5,[d.Sand]:3.5,[d.Snow]:3.5,[d.Ice]:10,[d.PlayerBuilding]:3,[d.Tree]:5,[d.Rock]:5,[d.Base]:Number.EPSILON},le={[d.Fence]:5,[d.ElectricFence]:40,[d.Wall]:500,[d.Freezer]:.5,[d.Obstructed]:500,[d.PlayerBuilding]:-10},Zi={[d.Grass]:3,[d.Water]:3,[d.Stone]:3,[d.Wall]:3,[d.Spore]:3,[d.ElectricFence]:3,[d.Fence]:3,[d.Freezer]:6,[d.Obstructed]:3,[d.Bridge]:3,[d.Dirt]:3,[d.Sand]:3,[d.Snow]:3,[d.Ice]:3,[d.PlayerBuilding]:3,[d.Tree]:3,[d.Rock]:3,[d.Base]:Number.EPSILON},Qi={[d.Fence]:3,[d.ElectricFence]:3,[d.Wall]:5,[d.Tree]:4,[d.Rock]:3,[d.Freezer]:.5,[d.Obstructed]:5,[d.PlayerBuilding]:-10},vt=600;class he{constructor(t,e){r(this,"predictedHp");r(this,"cooldown",0);r(this,"callback");this.enemy=t,this.hp=e,this.predictedHp=e}tick(t){if(this.cooldown<t&&this.callback&&(this.callback(),this.callback=void 0),this.cooldown=Math.max(0,this.cooldown-t),this.enemy.getPath().isPaused(this.enemy)&&!this.isBusy()){const e=this.enemy.getPath().getTile();this.enemy.entity.setX(e.getX()),this.enemy.entity.setY(e.getY());const s=this.enemy.getPath().getNextCheckpoint();s&&s.process(this.enemy.getPath().getTiles(),this.enemy,t)}if(this.isBusy())this.getTargeted(this.enemy.getPath().getCurrentTile(),t);else{this.enemy.isVisible()||this.enemy.getPath().fastForward(this.enemy);const{from:e,to:s,step:i}=this.enemy.getPath().performStep(this.enemy,t);this.enemy.entity.move(e,s,i),this.getTargeted(e,t)}}attack(t){t.hit&&this.cooldown===0&&(t.hit(this.enemy.getDamage()*c.Instance.getDamageMultiplier()),this.cooldown=this.enemy.isVisible()?vt:0)}interact(t,e=vt){this.callback=t,this.cooldown===0&&this.enemy.isVisible()&&(this.cooldown=e)}getTargeted(t,e){if(this.predictedHp>0&&this.enemy.isVisible()){for(let s of t.getAvailableTowers())if(this.predictedHp-=s.fire(this.enemy,e),this.predictedHp<=0)break}}hit(t){this.hp-=t,this.hp<this.predictedHp&&(this.predictedHp=this.hp),this.hp<=0&&c.Instance.despawnEnemy(this.enemy)}miss(t){this.predictedHp+=t}isBusy(){return this.cooldown!==0}getFuturePosition(t){const e=this.enemy.getPath().getFuturePosition(t),s=this.enemy.getPath().getCheckpoints();for(let i=0;i<s.length;i++){let a=s[i];if(a.index>e)return e;if(a.isBlocking)return a.index-1}return e}}const Ts=new Set(Ms);Ts.delete(h.Tree);const Ji=ae(Ts),tn=3e3,en=.01,sn=.025,nn=30,Ne=class{constructor(t,e){r(this,"entity");r(this,"category",M.Enemy);r(this,"status",P.Normal);r(this,"statusDuration",0);r(this,"renderData",{});r(this,"ai");this.path=e,this.entity=new V(t.getX(),t.getY(),this),this.ai=new he(this,nn)}initializePath(){this.path.setSpeed(sn),this.path.setCheckpoints(Ji(this.path.getTiles()))}get AI(){return this.ai}getDamage(){return 4}getType(){return Ne.type}getPath(){return this.path}getStatus(){return this.status}tick(t){this.status===P.OnFire&&(this.statusDuration-=t,this.statusDuration<=0?this.status=P.Normal:this.ai.hit(en*t)),this.ai.tick(t)}isVisible(){return this.path.getTile().isDiscovered()}lightOnFire(){this.status=P.OnFire,this.statusDuration=tn}};let K=Ne;r(K,"pathCosts",es(oe,{[d.Tree]:3})),r(K,"pathMultipliers",es(le,{[d.Water]:2})),r(K,"type",h.Runner),r(K,"cost",5);class rn{constructor(t,e,s){r(this,"paths");this.pathfinder=t,this.startPoints=e,this.target=s}getPaths(){if(!this.paths){const t=this.startPoints.map(s=>this.pathfinder.getSurface().getTile(s.getX(),s.getY())),e=this.pathfinder.getSurface().getTile(this.target.getX(),this.target.getY());this.paths=this.pathfinder.getHivePath(t,e).filter(s=>!!s)}return this.paths}update(){this.paths=void 0}}class ct{constructor(t,e,s,i,a,o=[]){r(this,"index",0);r(this,"sectionIndex",0);r(this,"tileSet");this.pathfinder=t,this.tiles=e,this.sections=s,this.speed=i,this.costs=a,this.checkpoints=o,this.tileSet=new Set(e)}performStep(t,e){var y,g;const s=this.index%1,i=this.index|0,a=this.tiles[i],o=this.speed*e/((y=this.costs[i])!=null?y:1);let l=this.index+o|0;i===l&&l++,l>=this.tiles.length-1&&(l=this.tiles.length-1);const u=this.tiles[l];for(;this.checkpoints.length>0;){const f=this.checkpoints[0];if(f&&l>=f.index)if(f.isCleared(this.tiles,t))this.checkpoints.shift();else return this.index=f.index-1,{from:this.tiles[this.index],to:u,step:0};else break}const p=(g=this.costs[l])!=null?g:1;for(this.index=Math.min(this.index+this.speed*e/p,this.tiles.length-1);this.index>this.sections[this.sectionIndex].to;)this.sectionIndex++;return{from:a,to:u,step:s}}getFuturePosition(t){let e=this.index,s=this.sectionIndex;for(;t>0;){const i=this.sections[s],a=i.to-e,o=a/this.speed*i.cost;if(t>o?(e+=a,s++,t-=o):(e+=a*t/o,t=0),e>=this.tiles.length-1)return this.tiles.length-1}return e}fastForward(t){let e=this.checkpoints[0];for(let s=(this.index|0)+1;s<this.tiles.length;s++){if(e&&s>=e.index)if(e.isCleared(this.tiles,t))this.checkpoints.shift(),e=this.checkpoints[0];else break;if(this.getTile(s).isDiscovered())break;this.index=s}}clone(){return new ct(this.pathfinder,this.tiles,this.sections,this.speed,this.costs,[...this.checkpoints])}slice(t=0,e=Number.MAX_VALUE){const s=this.tiles.slice(t,e),i=this.costs.slice(t,e),a=ct.calculateSections(s,i),o=this.checkpoints.filter(l=>l.index>=t&&l.index<e);return new ct(this.pathfinder,s,a,this.speed,i,o)}setIndex(t){this.index=Math.max(Math.min(t,this.tiles.length-1),0),this.sectionIndex=this.sections.findIndex(({from:e,to:s})=>this.index>=e&&this.index<s)}getIndex(){return this.index}getTile(t=this.index){return this.tiles[t|0]}getTiles(){return this.tiles}getLength(){return this.tiles.length}getCoordinates(t=this.index){if(t>=this.tiles.length-1){const a=this.tiles[this.tiles.length-1];return{x:a.getX(),y:a.getY()}}const e=t%1,s=this.tiles[t|0],i=this.tiles[(t|0)+1];return{x:(i.getX()-s.getX())*e+s.getX(),y:(i.getY()-s.getY())*e+s.getY()}}getSpeed(){return this.speed}setSpeed(t){this.speed=t}isDone(){return this.index===this.tiles.length-1}isPaused(t){if(this.isDone())return!0;const e=this.getNextCheckpoint();return e&&e.index===this.index+1&&!e.isCleared(this.tiles,t)}getNextCheckpoint(){return this.checkpoints[0]||null}getCheckpoints(){return this.checkpoints}setCheckpoints(t){this.checkpoints=t}getCurrentTile(){return this.tiles[this.index|0]}recompute(){var s;const t=this.pathfinder.getSurface();let e;for(let i=0;i<this.tiles.length;i++){const a=this.tiles[i],o=t.getTile(a.getX(),a.getY());this.tiles[i]=o,this.costs[i]=(s=this.pathfinder.getCost(o,e))!=null?s:1,e=o,a!==o&&(this.tileSet.delete(a),this.tileSet.add(o))}this.sections=ct.calculateSections(this.tiles,this.costs)}isAffectedByTiles(t){for(let e of t)if(this.tileSet.has(e))return!0;return!1}static calculateSections(t,e){return t.reduce((s,i,a)=>{const o=s[s.length-1],l=e[a];return o?(o.cost===l?o.to++:s.push({from:a,to:a+1,cost:l}),s):[{from:a,to:a+1,cost:l}]},[])}static fromTiles(t,e,s=1){const i=new ct(t,e,[],s,[]);return i.recompute(),i}static fromMapAndCosts(t,e,s,i,a=1){let o=s;const l=[o];for(;o!==e;)o=i.get(o.getHash()),l.push(o);return this.fromTiles(t,l.reverse(),a)}}const an=[[0,-1],[-1,0],[1,0],[0,1],[-1,-1],[1,-1],[-1,1],[1,1]],on=150;class ln{constructor(t,e=le,s=oe){r(this,"costFn");r(this,"costMultiplierFn");this.surface=t,this.costMultiplierFn=typeof e=="function"?e:i=>{var a;return(a=e[i.getType()])!=null?a:1},this.costFn=typeof s=="function"?s:i=>{var a;return(a=s[i.getType()])!=null?a:null}}getPath(t,e,s){var E;const i=s!=null?s:this.costMultiplierFn,a=new Set,l=((E=this.costFn(t))!=null?E:1)*i(t),u=new Map;u.set(t.getHash(),l);const p=new Map;p.set(t.getHash(),l);const y=new Map;y.set(t.getHash(),l+this.heuristic(t,e));const g=new _i((v,I)=>{var A,b;return((A=y.get(v.getHash()))!=null?A:1/0)-((b=y.get(I.getHash()))!=null?b:1/0)});g.push(t);const f=new Map;for(;!g.empty();){let v=g.pop();if(e===v)return ct.fromMapAndCosts(this,t,e,f);const I=v.getHash(),A=an.map(([X,W])=>this.surface.getTile(X+v.getX(),W+v.getY())),b=[];this.setCostAndMultiplier(0,b,i,A[0]),this.setCostAndMultiplier(1,b,i,A[1]),this.setCostAndMultiplier(2,b,i,A[2]),this.setCostAndMultiplier(3,b,i,A[3]),this.setDiagonalCostAndMultiplier(4,0,1,b,i,A[4]),this.setDiagonalCostAndMultiplier(5,0,2,b,i,A[5]),this.setDiagonalCostAndMultiplier(6,1,3,b,i,A[6]),this.setDiagonalCostAndMultiplier(7,2,3,b,i,A[7]),A.forEach((X,W)=>{var at;if(!X)return;const H=b[W*2];if(!H||a.has(X))return;const G=X.getHash(),j=p.get(I)+b[W*2+1];if(j<((at=p.get(G))!=null?at:1/0)){const ue=u.get(I)+H;u.set(G,ue),f.set(G,v),p.set(G,j),y.set(G,j+this.heuristic(X,e)),g.push(X),a.add(v)}})}}getHivePath(t,e){const s={},i=a=>{var o;return((o=s[a.getHash()])!=null?o:1)*this.costMultiplierFn(a)};return t.reduce((a,o,l)=>{const u=this.getPath(o,e,i);return a.push(u),u&&t.length>l-1&&u.getTiles().forEach(p=>{p.hasStaticEntity()&&(s[p.getHash()]=.85),s[p.getHash()]=s[p.getHash()]+.1||1.1}),a},[])}getCost(t,e){if(!e)return this.costFn(t);const s=this.costFn(t),i=this.costFn(e);if(!s||!i)return null;const a=(s+i)/2;return!s||!i||t.getX()===e.getX()||t.getY()==e.getY()?a:a+(this.costFn(this.surface.getTile(t.getX(),e.getY()))+this.costFn(this.surface.getTile(e.getX(),t.getY())))/4}getSurface(){return this.surface}heuristic(t,e){return Math.abs(t.getX()-e.getX())+Math.abs(t.getY()-e.getY())}setCostAndMultiplier(t,e,s,i){if(!i)return;const a=this.costFn(i);a&&(e[t*2]=a,e[t*2+1]=a*s(i))}setDiagonalCostAndMultiplier(t,e,s,i,a,o){if(!o||!i[e*2]||!i[s*2])return;const l=i[e*2+1]+i[s*2+1];if(l>on)return;const u=this.costFn(o);u&&(i[t*2]=u+(i[e*2]+i[s*2])/4,i[t*2+1]=u*a(o)+l/4)}}class Be{constructor(t,e,s){r(this,"index",0);r(this,"pathData",new Map);r(this,"strength",0);r(this,"unit",K);r(this,"energy",25);r(this,"spawnInterval",200);r(this,"spawnDelay",0);r(this,"burstSize",Number.POSITIVE_INFINITY);r(this,"burstInterval",1e3);r(this,"burst",0);r(this,"timer",0);r(this,"centerX",0);r(this,"centerY",0);this.spawnPoints=t,this.target=e,this.surface=s,t.forEach(i=>{this.centerX+=i.getX(),this.centerY+=i.getY()}),this.centerX/=t.length,this.centerY/=t.length}setUnit(t){this.unit=t}getUnitType(){return this.unit.type}setParameters(t,e,s,i,a){this.energy=t,this.spawnInterval=e,this.spawnDelay=s,this.burstSize=i,this.burstInterval=a,this.burst=0,this.timer=0}getEnergy(){return this.energy}tick(t){if(this.energy!==0){if(this.timer+=t,this.spawnDelay>0)if(this.timer>this.spawnDelay)this.timer-=this.spawnDelay,this.spawnDelay=0;else return;if(this.burst>=this.burstSize)if(this.timer>=this.burstInterval)this.timer-=this.burstInterval,this.burst=0;else return;if(this.timer>=this.spawnInterval){this.timer-=this.spawnInterval,this.energy=Math.max(0,this.energy-this.unit.cost);const e=this.getNextUnit();c.Instance.spawnEnemy(e)}}}getCenter(){return[this.centerX,this.centerY]}getPathData(t){return this.pathData.has(t)||this.pathData.set(t,new rn(new ln(this.surface,this.unit.pathMultipliers,this.unit.pathCosts),this.spawnPoints,this.target)),this.pathData.get(t)}getSpawnPoints(){return this.getPathData(this.unit.type).getPaths()}getNextSpawnPoint(){const t=this.getSpawnPoints(),e=t[this.index];return this.index=(this.index+1)%t.length,e}getNextUnit(){const t=this.getNextSpawnPoint().clone(),e=new this.unit(t.getTile(),t);return e.initializePath(),e}grow(){this.strength++}getStrength(){return this.strength}isExposed(){const t=this.getSpawnPoints();return t.reduce((s,i)=>i.getTile(0).getDiscoveryStatus()!==L.Undiscovered?s+1:s,0)/t.length}rePath(){this.pathData.forEach(t=>t.update())}static fromTiles(t,e,s){return new Be(t,e,s)}}const hn=(n,t)=>{const e=new Array(t).fill(0).map(Math.random),s=e.reduce((i,a)=>i+a);return e.map(i=>i/s*n)},yt=()=>{let n=1-Math.random(),t=Math.random(),e=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*t);return e=e/10+.5,e>1||e<0?yt():e},cn=ae(De),un=3e3,dn=.01,gn=.006,pn=80,Ue=class{constructor(t,e){r(this,"entity");r(this,"category",M.Enemy);r(this,"status",P.Normal);r(this,"statusDuration",0);r(this,"renderData",{});r(this,"ai");this.path=e,this.entity=new V(t.getX(),t.getY(),this),this.ai=new he(this,pn)}initializePath(){this.path.setSpeed(gn),this.path.setCheckpoints(cn(this.path.getTiles()))}get AI(){return this.ai}getDamage(){return 7}getType(){return Ue.type}getPath(){return this.path}getStatus(){return this.status}tick(t){this.status===P.OnFire&&(this.statusDuration-=t,this.statusDuration<=0?this.status=P.Normal:this.ai.hit(dn*t)),this.ai.tick(t)}isVisible(){return this.path.getTile().isDiscovered()}lightOnFire(){this.status=P.OnFire,this.statusDuration=un}};let ot=Ue;r(ot,"pathCosts",Zi),r(ot,"pathMultipliers",Qi),r(ot,"type",h.Flier),r(ot,"cost",12);const Is=(n,...t)=>{const e=[];return t.filter(Boolean).forEach(s=>e.push(...s(n))),e.sort((s,i)=>s.index-i.index),e},_e=(n,t)=>{if(n>Math.random())return t},Te=new Set([d.Grass,d.Snow]);class fn{constructor(t){r(this,"isBlocking",!1);this.index=t}isCleared(t,e){return!Te.has(t[this.index-1].getType())}process(t,e,s){const i=c.Instance.getSurface(),a=t[this.index-1];Te.has(a.getType())&&i.setTile(new z(a.getX(),a.getY(),d.Dirt))}}const As=n=>{const t=[],e=Math.random()*n.length/10,s=n.filter(i=>Te.has(i.getType()));for(let i=0;i<e&&s.length;i++){const a=s.splice(Math.floor(Math.random()*s.length),1)[0];t.push(new fn(n.indexOf(a)+1))}return t};class ss{constructor(t){r(this,"isBlocking",!0);this.index=t}isCleared(t,e){return!this.getTiles(t[this.index],e).length}process(t,e,s){const i=c.Instance.getSurface(),a=t[this.index],o=this.getTiles(a,e);if(o.length>0){const l=o[0];e.entity.lookAt(l),e.AI.interact(()=>{i.getTile(l.getX(),l.getY()).getType()===d.Water&&i.setTile(new z(l.getX(),l.getY(),d.Bridge))})}}getTiles(t,e){const s=c.Instance.getSurface(),i=[];return t.getType()===d.Water&&i.push(t),e.entity.getAlignedX()!==t.getX()&&e.entity.getAlignedY()!==t.getY()&&[[e.entity.getAlignedX(),t.getY()],[t.getX(),e.entity.getAlignedY()]].forEach(([a,o])=>{const l=s.getTile(a,o);(l==null?void 0:l.getType())===d.Water&&i.push(l)}),i}}const mn=n=>{const t=[];for(let e=0;e<n.length;e++)n[e].getType()===d.Water&&(t.push(new ss(e)),e+1<n.length&&n[e+1].getType()!==d.Water&&t.push(new ss(e+1)));return t},yn=ae(),wn=3e3,vn=.01,En=.01,Sn=100,We=class{constructor(t,e){r(this,"entity");r(this,"category",M.Enemy);r(this,"status",P.Normal);r(this,"statusDuration",0);r(this,"renderData",{});r(this,"ai");this.path=e,this.entity=new V(t.getX(),t.getY(),this),this.ai=new he(this,Sn)}initializePath(){this.path.setSpeed(En),this.path.setCheckpoints(Is(this.path.getTiles(),yn,_e(.5,As),_e(.1,mn)))}get AI(){return this.ai}getDamage(){return 6}getType(){return We.type}getPath(){return this.path}getStatus(){return this.status}tick(t){this.status===P.OnFire&&(this.statusDuration-=t,this.statusDuration<=0?this.status=P.Normal:this.ai.hit(vn*t)),this.ai.tick(t)}isVisible(){return this.path.getTile().isDiscovered()}lightOnFire(){this.status=P.OnFire,this.statusDuration=wn}};let lt=We;r(lt,"pathCosts",oe),r(lt,"pathMultipliers",le),r(lt,"type",h.Slime),r(lt,"cost",7);const Mn=ae(),bn=3e3,_n=.01,Tn=.008,In=200,He=class{constructor(t,e){r(this,"entity");r(this,"category",M.Enemy);r(this,"status",P.Normal);r(this,"statusDuration",0);r(this,"renderData",{});r(this,"ai");this.path=e,this.entity=new V(t.getX(),t.getY(),this),this.ai=new he(this,In)}initializePath(){this.path.setSpeed(Tn),this.path.setCheckpoints(Is(this.path.getTiles(),Mn,_e(.5,As)))}get AI(){return this.ai}getDamage(){return 9}getType(){return He.type}getPath(){return this.path}getStatus(){return this.status}tick(t){this.status===P.OnFire&&(this.statusDuration-=t,this.statusDuration<=0?this.status=P.Normal:this.ai.hit(_n*t)),this.ai.tick(t)}isVisible(){return this.path.getTile().isDiscovered()}lightOnFire(){this.status=P.OnFire,this.statusDuration=bn}};let ht=He;r(ht,"pathCosts",oe),r(ht,"pathMultipliers",le),r(ht,"type",h.Tank),r(ht,"cost",20);const An=4e3,Cn=200,xn=500,kn=500,Pn=3e3,Dn=3,Rn=12,Fn=1.1,Bn={[$.Easy]:0,[$.Normal]:1.5*K.cost,[$.Hard]:3*K.cost};class Ct{constructor(t){this.spawnGroups=t}isDone(){return!this.spawnGroups.find(t=>t.getEnergy()>0)}getSpawnGroups(){return this.spawnGroups}tick(t){this.spawnGroups.forEach(e=>e.tick(t))}static fromSpawnGroups(t,e){const s=(1+t**2)*K.cost,i=hn(s,e.length),a=Bn[c.Instance.getDifficulty()];return e.forEach((o,l)=>{const u=i[l]*Fn+a*o.getStrength(),p=l===0||Math.random()>.5?0:yt()*An,y=Math.random()>.5?yt()*Rn+Dn:Number.POSITIVE_INFINITY;o.setParameters(u,yt()*xn+Cn,p,y,yt()*Pn+kn)}),new Ct(e)}static getUnitForLevel(t){if(t===0)return K;const e=Math.random();return e<Math.min(.2,.75-t**2/100)?K:t>=3&&e>Math.max(.7,1-t/50)?ot:e>.1+t/25?lt:ht}}class Ln{constructor(t,e,s){r(this,"spawnGroups",[]);r(this,"nextSpawnGroup");r(this,"direction",Math.random()*Math.PI*2);r(this,"wave");r(this,"timeSinceLastExpansion",0);r(this,"level",0);r(this,"onSurfaceChange",({affectedTiles:t,removedStaticAgents:e})=>{const s=this.isWaveInProgress();this.spawnGroups.forEach(a=>{s?a.getSpawnPoints().forEach(o=>{o.isAffectedByTiles(t)&&o.recompute()}):(e.size>0||!!a.getSpawnPoints().find(l=>l.isAffectedByTiles(t)))&&a.rePath()});const i=this.getNextSpawnGroup();!s&&i&&(e.size>0||!!i.getSpawnPoints().find(o=>o.isAffectedByTiles(t)))&&i.rePath()});this.base=t,this.surface=e,this.visibilityController=s,c.Instance.addEventListener(k.SurfaceChange,this.onSurfaceChange)}tick(t){!this.wave||this.wave.tick(t)}startNewWave(){this.visibilityController.hasPendingAgents()&&(this.timeSinceLastExpansion=0);for(let e=this.spawnGroups.length-1;e>=0;e--){const s=this.spawnGroups[e];s.isExposed()?this.spawnGroups.splice(e,1):(s.grow(),s.rePath())}this.direction+=(Math.random()>.5?1:-1)*Math.max(Math.PI/6*yt()*Math.min(Math.PI*2,(this.level+1)/1.5));const t=this.getNextSpawnGroup();if(t){this.timeSinceLastExpansion=0;const e=t.getSpawnPoints()[0].getTile(0),s=[];this.surface.forCircle(e.getX(),e.getY(),5,i=>{Fe.has(i.getType())&&s.push(new z(i.getX(),i.getY(),d.Spore))}),this.surface.setTiles(s),this.spawnGroups.push(t),this.nextSpawnGroup=void 0}this.wave=Ct.fromSpawnGroups(this.level,this.spawnGroups),this.level++}processWave(){return this.isWaveInProgress()?!1:(this.timeSinceLastExpansion++,this.spawnGroups.forEach(t=>t.setUnit(Ct.getUnitForLevel(this.level))),!0)}getLevel(){return this.level}getWave(){return this.wave}getSpawnGroups(){let t;return this.isWaveInProgress()||(t=this.getNextSpawnGroup()),t?[...this.spawnGroups,t]:[...this.spawnGroups]}getSpawnAlertRanges(){return mt.forSpawnGroups(this.getSpawnGroups())}isWaveInProgress(){return this.wave&&!this.wave.isDone()?!0:this.surface.getEntitiesForCategory(M.Enemy).size>0}getNextSpawnGroup(){const t=Math.ceil(2**this.spawnGroups.length/3),e=this.visibilityController.hasPendingAgents()?0:this.timeSinceLastExpansion;if(!(this.spawnGroups.filter(o=>!o.isExposed()).length===0||e>=t))return;if(this.nextSpawnGroup&&!this.nextSpawnGroup.isExposed())return this.nextSpawnGroup;let i=!1,a=3;for(let o=0;o<20&&(this.surface.forRay(this.base.getTile().getX(),this.base.getTile().getY(),this.direction,l=>l.getDiscoveryStatus()!==L.Undiscovered?(a=4+Math.floor(Math.random()*4),!0):(a--,a>0||!Re.has(l.getType())?!0:(this.nextSpawnGroup=Be.fromTiles([l,l,l,l],this.base.getTile(),this.surface),this.nextSpawnGroup.setUnit(Ct.getUnitForLevel(this.level)),i=!0,!1))),!i);o++)this.direction+=Math.PI/10;return this.nextSpawnGroup}}const je=class{constructor(t,e,s,i,a){r(this,"eventHandlers");r(this,"visibilityController");r(this,"powerController");r(this,"moneyController");r(this,"buildController");r(this,"unlocksController");r(this,"waveController");r(this,"base");this.difficulty=t,this.surface=s,this.controller=i,this.messageFn=a,je.instance=this,this.eventHandlers=new Map,this.visibilityController=new Ki(s),this.base=new _s(e),this.waveController=new Ln(this.base,this.surface,this.visibilityController)}getSurface(){return this.surface}getController(){return this.controller}getVisibilityController(){return this.visibilityController}getPowerController(){return this.powerController}getBuildController(){return this.buildController}getMoneyController(){return this.moneyController}getUnlocksController(){return this.unlocksController}getWaveController(){return this.waveController}getBase(){return this.base}getDifficulty(){return this.difficulty}addEventListener(t,e){return this.eventHandlers.has(t)?this.eventHandlers.get(t).add(e):this.eventHandlers.set(t,new Set([e])),()=>this.removeEventListener(t,e)}addEventListeners(t,e){const s=t.map(i=>this.addEventListener(i,e));return()=>s.forEach(i=>i())}removeEventListener(t,e){var s;(s=this.eventHandlers.get(t))==null||s.delete(e)}triggerEvent(t,...e){var s;(s=this.eventHandlers.get(t))==null||s.forEach(i=>i(...e))}static get Instance(){return this.instance}};let c=je;r(c,"instance");class Cs{constructor(t){r(this,"entity");r(this,"category",M.Unknown);r(this,"hp",30);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Tree}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return this.tile.isDiscovered()}}r(Cs,"scale",1);class xs{constructor(t){r(this,"entity");r(this,"category",M.Unknown);r(this,"hp",30);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Rock}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return this.tile.isDiscovered()}}r(xs,"scale",1);const Yn=n=>{const t=Ti(n),e=Ii(t),s=e(1,0)*193,i=e(0,1)*197,a=.048,o=.0077,l=.0025,u=.0194,p=.95;return(g,f)=>{const E=g+s,v=f+i,I=e(E*a,v*a),A=e(E*l,v*l),b=Math.abs(A),X=e(E*o,v*o),W=1-Math.abs(X),H=e(E*u,v*u),G=Math.abs(H),j=(A+H/3)*.83,at=j+b*9241%1/3,ue=W>p+j/10,Si=W+I/3+H-.4>p+j/2;if(ue||Si)return A+b*1811%1/7<-.6?new z(g,f,d.Ice):new z(g,f,d.Water);if(W>p+j/15)return new z(g,f,d.Dirt);let st;j>.3?st=new z(g,f,d.Sand):j<-.5?st=new z(g,f,d.Snow):st=new z(g,f,d.Grass);const Qe=(H+.5)*(I-.5)+b*5419%1/10;if(Qe<.07&&Qe>.04&&at>-.4&&at<.6){const de=new Cs(st);st.setStaticEntity(de.entity)}else if((at<-.5||at>.7)&&G*2791%1>.99){const de=new xs(st);st.setStaticEntity(de.entity)}return st}};class Xn{constructor(t=50,e=25,s=(i,a)=>new z(i,a)){r(this,"map");r(this,"entities",[]);r(this,"deletedEntities",[]);r(this,"staticEntities",[]);r(this,"entitiesMap",new Map);r(this,"dirty",!1);r(this,"changedTiles",new Set);r(this,"addedAgents",new Set);r(this,"removedAgents",new Set);this.width=t,this.height=e,this.generate=s,this.initialize()}initialize(){this.map=new Array(this.width*this.height);for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.map[t*this.width+e]=this.generate(e,t);this.entities=[],this.deletedEntities=[],this.staticEntities=[],this.entitiesMap.clear(),Object.values(M).filter(t=>typeof t!="string").forEach(t=>this.entitiesMap.set(t,new Set))}getTile(t,e,s=!1){return t>=this.width||t<0||e>=this.height||e<0?s?this.getTile(Math.max(Math.min(t,this.width-1),0),Math.max(Math.min(e,this.height-1),0)):void 0:this.map[e*this.width+t]}getEntityTiles(t,e,s){let i;if(e)i=t;else{const a=t;i=a.getTile().getX(),e=a.getTile().getY(),s=rt(a)}switch(s){case 1:return[this.map[e*this.width+i]];case 2:return[this.map[e*this.width+i],this.map[e*this.width+i+1],this.map[(e+1)*this.width+i],this.map[(e+1)*this.width+i+1]];default:throw new Error("Unsupported agent scale!")}}getAdjacentTiles(t,e=1){return[[1,0],[-1,0],[0,1],[0,-1]].map(([i,a])=>this.getTile(t.getX()+i*e,t.getY()+a*e)).filter(i=>!!i)}setTile(t){this.setTileInternal(t)}setTiles(t){t.map(e=>this.setTileInternal(e))}setTileInternal(t){this.dirty=!0;const e=this.map[t.getY()*this.width+t.getX()];return e.hasStaticEntity()&&!t.hasStaticEntity()?t.setStaticEntity(e.getStaticEntity()):e.hasStaticEntity()&&this.despawnStatic(e.getStaticEntity().getAgent()),t.sync(e),this.map[t.getY()*this.width+t.getX()]=t,this.changedTiles.add(e),e}processChangedTiles(){!this.changedTiles.size||(c.Instance.triggerEvent(k.SurfaceChange,{affectedTiles:this.changedTiles,addedStaticAgents:this.addedAgents,removedStaticAgents:this.removedAgents}),this.changedTiles.clear(),this.addedAgents.clear(),this.removedAgents.clear())}getRow(t){const e=t*this.width;return this.map.slice(e,e+this.width)}getColumn(t){const e=new Array(this.height);for(let s=0;s<this.height;s++)e[s]=this.getTile(t,s);return e}getWidth(){return this.width}getHeight(){return this.height}forLine(t,e,s,i,a,o){var p;const l=(p=o==null?void 0:o.scale)!=null?p:1;t=Math.floor(t/l)*l,e=Math.floor(e/l)*l,s=Math.floor(s/l)*l,i=Math.floor(i/l)*l;const u=Math.atan2(i-e,s-t);return this.forRay(t,e,u,(y,g)=>!(a(y,g)===!1)&&!(y.getX()===s&&y.getY()===i),o)}forRay(t,e,s,i,a){var b,X;const o=(b=a==null?void 0:a.connected)!=null?b:!1,l=(X=a==null?void 0:a.scale)!=null?X:1,u=Math.cos(s),p=Math.sin(s),y=Math.abs(u)+Math.abs(p);let g=Math.abs(u/y),f=Math.abs(p/y),E=(1+(g>f?f/g:g/f))*l;g*=E*Math.sign(u),f*=E*Math.sign(p);let v,I,A=0;for(;;){let W=!1;const H=Math.round(t/l)*l;let G=Math.round(e/l)*l;o&&v!==void 0&&Math.round(v/l)*l!==H&&Math.round(I/l)*l!==G&&(G=Math.round(I),W=!0);const j=this.getTile(H,G);if(!j||!i(j,A))break;W||(t+=g,e+=f),v=H,I=G,A++}}forRect(t,e,s,i,a,o){var y;const l=(y=o==null?void 0:o.scale)!=null?y:1;t=Math.floor(t/l)*l,e=Math.floor(e/l)*l,s=Math.floor(s/l)*l,i=Math.floor(i/l)*l;const u=(g,f)=>{const E=this.getTile(g,f);E&&a(E)},p=g=>{if(s>t)for(let f=t;f<=s;f+=l)u(f,g);else for(let f=t;f>=s;f-=l)u(f,g)};if(i>e)for(let g=e;g<=i;g+=l)p(g);else for(let g=e;g>=i;g-=l)p(g)}forCircle(t,e,s,i,a){var f,E;const o=(f=a==null?void 0:a.edgeOnly)!=null?f:!1,l=(E=a==null?void 0:a.scale)!=null?E:1;t=Math.floor(t/l),e=Math.floor(e/l);let u=s/2;const p=u*u,y=(u-1)*(u-1),g=(v,I,A=0)=>{const b=v+A,X=I+A,W=b*b+X*X;if(W<p&&!(o&&W<y)){const H=this.getTile((t+v)*l,(e+I)*l,o);H&&i(H)}};if(s%2===0)for(let v=-u;v<u;v+=1)for(let I=-u;I<u;I+=1)g(I,v,.5);else{u=u|0;for(let v=-u;v<u+1;v+=1)for(let I=-u;I<u+1;I+=1)g(I,v)}}spawn(t){this.entities.push(t.entity),this.entitiesMap.get(t.category).add(t.entity),t.spawn&&t.spawn()}spawnStatic(t){this.getEntityTiles(t).forEach(s=>{s.setStaticEntity(t.entity),this.changedTiles.add(s)}),this.addedAgents.add(t),this.spawn(t),this.dirty=!0}despawn(t){const e=this.entities.indexOf(t.entity);e>=0&&this.entities.splice(e,1);const s=this.entitiesMap.get(t.category).delete(t.entity);return this.deletedEntities.push(t.entity),t.despawn&&t.despawn(),s}despawnStatic(t){this.getEntityTiles(t).forEach(s=>{s.clearStaticEntity(),this.changedTiles.add(s)}),this.removedAgents.add(t),this.despawn(t),this.dirty=!0}getEntities(){return this.entities}getEntitiesForCategory(t){return this.entitiesMap.get(t)}getDeletedEntities(){return this.deletedEntities}getStaticEntities(){return this.staticEntities}markPristine(){this.dirty=!1,this.deletedEntities=[]}forceRerender(){this.dirty=!0}isDirty(){return this.dirty}}var N=(n=>(n.Shift="Shift",n.Control="Control",n.Meta="Meta",n.Plus="+",n.Minus="-",n.Equals="=",n.Up="ArrowUp",n.Left="ArrowLeft",n.Right="ArrowRight",n.Down="ArrowDown",n.W="w",n.A="a",n.S="s",n.D="d",n.Z="z",n.Q="q",n.B="b",n))(N||{});const On=new Set(Object.values(N));function is(n){return On.has(n)}class $n{constructor(t){r(this,"mouseDownX",0);r(this,"mouseDownY",0);r(this,"mouseX",0);r(this,"mouseY",0);r(this,"pressedKeys",{});r(this,"_isMouseDown",!1);r(this,"eventHandlers",new Map);r(this,"selectedPlacable",null);r(this,"buildMenuOpen",!1);this.surface=t}getPlacable(){return this.selectedPlacable}setPlaceable(t){this.selectedPlacable=t}mouseDown(t,e){this.mouseDownX=t,this.mouseDownY=e,this._isMouseDown=!0}mouseMove(t,e){this.mouseX=t,this.mouseY=e}getSelection(){var i,a,o,l;if(!this._isMouseDown)return[];let t=this.mouseX,e=this.mouseY;if(this.pressedKeys.Control||this.pressedKeys.Meta){let u=[];return this.surface.forRect(this.mouseDownX,this.mouseDownY,t,e,p=>{p.isDiscovered()&&u.push(p)},{scale:((a=(i=this.selectedPlacable)==null?void 0:i.entity)==null?void 0:a.scale)||1}),u}this.pressedKeys.Shift&&(Math.abs(t-this.mouseDownX)>Math.abs(e-this.mouseDownY)?e=this.mouseDownY:t=this.mouseDownX);let s=[];return this.surface.forLine(this.mouseDownX,this.mouseDownY,t,e,u=>{u.isDiscovered()&&s.push(u)},{scale:((l=(o=this.selectedPlacable)==null?void 0:o.entity)==null?void 0:l.scale)||1}),s}mouseUp(t,e){if(!this.selectedPlacable){this._isMouseDown=!1;return}const s=this.getSelection();c.Instance.getBuildController().build(s,this.selectedPlacable),this._isMouseDown=!1}keyDown(t){is(t)&&(this.pressedKeys[t]=!0)}keyUp(t){var e;is(t)&&(this.pressedKeys[t]=!1,(e=this.eventHandlers.get(t))==null||e.forEach(s=>s()),t==="b"&&this.toggleBuildMenu())}toggleBuildMenu(){this.buildMenuOpen=!this.buildMenuOpen,this.buildMenuOpen?c.Instance.triggerEvent(k.OpenBuildMenu):c.Instance.triggerEvent(k.CloseBuildMenu)}isKeyDown(t){var e;return(e=this.pressedKeys[t])!=null?e:!1}addKeyListener(t,e){return this.eventHandlers.has(t)?this.eventHandlers.get(t).add(e):this.eventHandlers.set(t,new Set([e])),()=>this.removeKeyListener(t,e)}removeKeyListener(t,e){var s;(s=this.eventHandlers.get(t))==null||s.delete(e)}isMouseDown(){return this._isMouseDown}getMouse(t){var s,i;const e=t||((i=(s=this.selectedPlacable)==null?void 0:s.entity)==null?void 0:i.scale)||1;return[Math.floor(this.mouseX/e)*e,Math.floor(this.mouseY/e)*e]}}const Ie=(n,t,e)=>new Promise(s=>{const i=c.Instance.addEventListener(t,(...a)=>{(!e||e(...a))&&(i(),s())})}).then(()=>n),ks=(n,t,e)=>new Promise(s=>{const i=c.Instance.addEventListeners(t,a=>{(!e||e(a))&&(i(),s())})}).then(()=>n),Ps=(n,...t)=>e=>ks(c.Instance.showMessage(n,{override:e}),t),Nn=Ps("Welcome to Open Tower Defense! Open the build menu by clicking the {key: \u{1F527}} button or by pressing {key: b}",k.OpenBuildMenu),Un=n=>Ie(c.Instance.showMessage("Build towers and walls near your base to protect it from enemies lurking in undiscovered areas",{override:n}),k.SurfaceChange,({affectedTiles:t})=>!!t.size),Wn=n=>new Promise(t=>{const e=c.Instance.getDifficulty();if(e===$.Hard){t(n);return}ks(c.Instance.showMessage(`Click the {key: \u{1F3AF}} button to view tower sight lines${e===$.Easy?" and enemy paths":" "} to check how effective your layout is`,{override:n}),[k.ToggleShowCoverage,k.StartWave]).then(t)}),Hn=n=>new Promise(t=>{if(c.Instance.getIsStarted()){Ie(n,k.EndWave).then(t);return}Ie(c.Instance.showMessage("Start the wave when you are ready. Good luck!",{override:n}),k.EndWave).then(t)}),jn=Ps("After beating a wave you can unlock a new building in the build menu strengthen your defense, take a look!",k.OpenBuildMenu),ns=[Nn,Un,Wn,Hn,jn];class Vn{constructor(){r(this,"promise");r(this,"reject");r(this,"previousId",-1)}async start(){this.promise=new Promise(async(t,e)=>{this.reject=e;for(let s=0;s<ns.length;s++){const i=ns[s];this.previousId=await i(this.previousId)}t()}),await this.promise}stop(){var t;(t=this.reject)==null||t.call(this)}}class Ds{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}spawn(){c.Instance.getBase().addPart(this),Lt(this,3)}despawn(){c.Instance.getBase().removePart(this)}getType(){return h.Armory}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){c.Instance.getBase().hit(t)}isVisible(){return!0}}r(Ds,"scale",2);const ie=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"hp",50);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}spawn(){c.Instance.getSurface().getAdjacentTiles(this.tile,ie.scale).forEach(t=>t.addLinkedAgent(this))}despawn(){c.Instance.getSurface().getAdjacentTiles(this.tile,ie.scale).forEach(t=>t.removeLinkedAgent(this))}getType(){return h.SpeedBeacon}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}};let xt=ie;r(xt,"scale",2);const Gn=.625;class Rs{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"isEnabled",!0);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this),t.addTower(this)}getCooldown(){return this.isEnabled?0:1}fire(t,e){if(!c.Instance.consumeContinuous(this,e))return 0;const s=Gn*e;return t.AI.hit(s),s}despawn(){this.tile.removeTower(this)}getType(){return h.ElectricFence}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}isVisible(){return!0}isSpeedBoosted(){return!1}isDamageBoosted(){return!1}}r(Rs,"scale",1);class Fs{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Fence}getTile(){return this.tile}updateTile(t){this.tile=t}isVisible(){return!0}}r(Fs,"scale",1);class Bs{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Freezer}getTile(){return this.tile}updateTile(t){this.tile=t}isVisible(){return!0}}r(Bs,"scale",2);class Ls{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}spawn(){c.Instance.getBase().addPart(this),Lt(this,3)}despawn(){c.Instance.getBase().removePart(this)}getType(){return h.Market}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){c.Instance.getBase().hit(t)}isVisible(){return!0}}r(Ls,"scale",2);class Ys{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.PowerPlant}getTile(){return this.tile}updateTile(t){this.tile=t}spawn(){c.Instance.getBase().addPart(this),Lt(this,3)}despawn(){c.Instance.getBase().removePart(this)}hit(t){c.Instance.getBase().hit(t)}isVisible(){return!0}}r(Ys,"scale",2);class Xs{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Radar}getTile(){return this.tile}updateTile(t){this.tile=t}spawn(){c.Instance.getVisibilityController().registerAgent(this),c.Instance.getBase().addPart(this),Lt(this,3)}despawn(){c.Instance.getVisibilityController().removeAgent(this),c.Instance.getBase().removePart(this)}hit(t){c.Instance.getBase().hit(t)}isVisible(){return!0}}r(Xs,"scale",2);const ne=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"hp",50);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}spawn(){c.Instance.getSurface().getAdjacentTiles(this.tile,ne.scale).forEach(t=>t.addLinkedAgent(this))}despawn(){c.Instance.getSurface().getAdjacentTiles(this.tile,ne.scale).forEach(t=>t.removeLinkedAgent(this))}getType(){return h.DamageBeacon}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}};let kt=ne;r(kt,"scale",2);const Yt=(n,t,e)=>{const s=c.Instance.getSurface(),i=new Set,a=()=>{const l=new Set(s.getEntityTiles(n));s.forCircle(n.entity.getX()+1,n.entity.getY()+1,t,u=>{s.forLine(n.entity.getX(),n.entity.getY(),u.getX(),u.getY(),p=>{if(p.addTower(n),i.add(p),!l.has(p)&&e&&e(p))return!1},{connected:!0})},{edgeOnly:!0})};a();const o=c.Instance.addEventListener(k.SurfaceChange,({affectedTiles:l})=>{for(const u of l)if(i.has(u)){i.forEach(p=>p.removeTower(n)),i.clear(),a();return}});return()=>{i.forEach(l=>l.removeTower(n)),o()}},Xt=n=>{let t=1;return n.forEach(e=>{e instanceof xt&&(t+=.5)}),t},Ot=n=>{let t=1;return n.forEach(e=>{e instanceof kt&&(t+=.5)}),t},zn=new Set([d.Obstructed,d.Wall,d.PlayerBuilding,d.Base]),$t=n=>zn.has(n.getType()),Ae=250;class Kn{constructor(t){r(this,"entity");r(this,"category",M.Unknown);r(this,"time",0);r(this,"renderData",{});r(this,"sourceX");r(this,"sourceY");this.source=t;const[e,s]=gt(t);this.entity=new V(e,s,this),this.sourceX=e,this.sourceY=s}dealDamage(t,e){this.renderData.update=!0,this.time>Ae&&c.Instance.getSurface().spawn(this),this.time=0;const s=Math.atan2(t.entity.getX()+.5-this.sourceX,t.entity.getY()+.5-this.sourceY);this.entity.setRotation(s*180/Math.PI),this.source.entity.setRotation(-this.entity.getRotation()+180),this.entity.setX(t.entity.getAlignedX()),this.entity.setY(t.entity.getAlignedY()),t.AI.hit(e),t.lightOnFire&&t.lightOnFire()}tick(t){this.time+=t,this.time>Ae&&c.Instance.getSurface().despawn(this)}getType(){return h.Flame}isVisible(){return!0}}const rs=1,qn=.04,Ve=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"cooldown",0);r(this,"cleanupEventListener");r(this,"flame");r(this,"hp",160);r(this,"isEnabled",!0);r(this,"speedMultiplier",1);r(this,"damageMultiplier",1);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}tick(t){!this.isEnabled||(this.cooldown=Math.max(0,this.cooldown-t))}fire(t,e){this.cooldown=rs;const s=c.Instance.consumeContinuous(this,e,this.damageMultiplier*this.speedMultiplier),i=qn*(s?this.damageMultiplier*this.speedMultiplier:1)*e;return this.flame||(this.flame=new Kn(this),c.Instance.getSurface().spawn(this.flame)),this.flame.dealDamage(t,i),this.renderData.fired=!0,i}spawn(){this.cleanupEventListener=Yt(this,Ve.range,$t)}despawn(){var t;(t=this.cleanupEventListener)==null||t.call(this)}updateLinkedAgents(t){this.speedMultiplier=Xt(t),this.damageMultiplier=Ot(t)}getCooldown(){return this.cooldown}getType(){return h.Flamethrower}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.cooldown=rs,this.isEnabled=!1}isSpeedBoosted(){return this.speedMultiplier>1}isDamageBoosted(){return this.damageMultiplier>1}};let Mt=Ve;r(Mt,"scale",2),r(Mt,"range",6);class Os{constructor(){r(this,"source");r(this,"target");r(this,"sourceX");r(this,"sourceY");r(this,"targetX");r(this,"targetY");r(this,"travelTime")}}function $s(n,t=0){const[e,s]=gt(this.source);this.sourceX=e,this.sourceY=s;const i=e-this.target.entity.getX()+.5,a=s-this.target.entity.getY()+.5,o=Math.sqrt(i*i+a*a)+t;this.travelTime=o/n;const l=this.target.AI.getFuturePosition(this.travelTime),{x:u,y:p}=this.target.getPath().getCoordinates(l);this.targetX=u+.5,this.targetY=p+.5}const Zn=.01,as=5,os=2,Qn=os*os;class Jn extends Os{constructor(e,s,i){super();r(this,"entity");r(this,"category",M.Unknown);r(this,"renderData",{});r(this,"time",0);r(this,"prevX");r(this,"prevY");this.source=e,this.target=s,this.damage=i,$s.call(this,Zn,as*2),this.entity=new V(this.sourceX,this.sourceY,this),this.entity.lookAt(this.targetX,this.targetY),this.source.entity.setRotation(this.entity.getRotation()),this.entity=new V(this.sourceX,this.sourceY,this),this.entity.lookAt(this.targetX,this.targetY),this.source.entity.setRotation(this.entity.getRotation())}tick(e){if(this.time>=this.travelTime){c.Instance.getSurface().despawn(this);let a=!1;[...c.Instance.getSurface().getEntitiesForCategory(M.Enemy)].filter(o=>{const l=o.getX()-this.entity.getX(),u=o.getY()-this.entity.getY();return l*l+u*u<Qn}).forEach(o=>{o.getAgent().AI.hit(this.damage),o.getAgent()===this.target&&(a=!0)}),a||this.target.AI.miss(this.damage)}this.time=Math.min(this.time+e,this.travelTime);const s=this.time/this.travelTime,i=Math.sin(s*Math.PI)*as;if(this.entity.setX(wt(this.sourceX,this.targetX,s)),this.entity.setY(wt(this.sourceY,this.targetY,s)-i),this.prevX&&this.prevY){const a=this.entity.getX()-this.prevX,o=this.entity.getY()-this.prevY;this.entity.setRotation(Math.atan2(o,a)*180/Math.PI+90)}this.prevX=this.entity.getX(),this.prevY=this.entity.getY()}getType(){return h.Rocket}isVisible(){return!0}}const ls=5e3,tr=50,Ge=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"cooldown",0);r(this,"cleanupEventListener");r(this,"hp",80);r(this,"isEnabled",!0);r(this,"speedMultiplier",1);r(this,"damageMultiplier",1);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}tick(t){!this.isEnabled||this.cooldown<=0||(this.cooldown-=t*this.speedMultiplier)}fire(t){this.cooldown+=ls;const e=c.Instance.consume(this,this.speedMultiplier,this.damageMultiplier),s=tr*(e?this.damageMultiplier:0),i=new Jn(this,t,s);return c.Instance.getSurface().spawn(i),this.renderData.fired=!0,s}spawn(){this.cleanupEventListener=Yt(this,Ge.range)}despawn(){var t;(t=this.cleanupEventListener)==null||t.call(this)}updateLinkedAgents(t){this.speedMultiplier=Xt(t),this.damageMultiplier=Ot(t)}getCooldown(){return this.cooldown}getType(){return h.Mortar}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.cooldown=ls,this.isEnabled=!1}isSpeedBoosted(){return this.speedMultiplier>1}isDamageBoosted(){return this.damageMultiplier>1}};let bt=Ge;r(bt,"scale",2),r(bt,"range",30);const er=(n,t,e,s,i)=>{const a=Math.atan2(i-t,s-n);let o=bs(a-e+Math.PI,Math.PI*2)-Math.PI;return Math.abs(o)>=Math.PI?Number.POSITIVE_INFINITY:Math.abs(Math.cos(e)*(t-i)-Math.sin(e)*(n-s))},hs=(n,t,e,s)=>(n-e)**2+(t-s)**2,Le=1500;class sr{constructor(t,e,s){r(this,"entity");r(this,"category",M.Unknown);r(this,"renderData",{});r(this,"targetX");r(this,"targetY");r(this,"time",0);this.source=t,this.damage=s;const[i,a]=gt(t);this.entity=new V(i,a,this);const o=Math.atan2(e.entity.getY()+.5-this.entity.getY(),e.entity.getX()+.5-this.entity.getX());this.entity.setRotation(o*180/Math.PI),this.source.entity.setRotation(this.entity.getRotation()+90),c.Instance.getSurface().forRay(e.entity.getX(),e.entity.getY(),o,u=>(this.targetX=u.getX(),this.targetY=u.getY(),!$t(u)));const l=hs(this.entity.getX(),this.entity.getY(),this.targetX,this.targetY);[...c.Instance.getSurface().getEntitiesForCategory(M.Enemy)].filter(u=>hs(this.entity.getX(),this.entity.getY(),u.getX()+.5,u.getY()+.5)<=l+1).filter(u=>er(this.entity.getX(),this.entity.getY(),o,u.getX()+.5,u.getY()+.5)<=.5).forEach(u=>{u.getAgent().AI.hit(this.damage)})}tick(t){this.time+=t,this.time>Le&&c.Instance.getSurface().despawn(this)}getType(){return h.Rail}isVisible(){return!0}}const cs=5e3,ir=70,ze=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"cooldown",0);r(this,"cleanupEventListener");r(this,"hp",80);r(this,"isEnabled",!0);r(this,"speedMultiplier",1);r(this,"damageMultiplier",1);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}tick(t){!this.isEnabled||this.cooldown<=0||(this.cooldown-=t*this.speedMultiplier)}fire(t){if(this.cooldown+=cs,!c.Instance.consume(this,this.speedMultiplier,this.damageMultiplier))return 0;const e=ir*this.damageMultiplier,s=new sr(this,t,e);return c.Instance.getSurface().spawn(s),this.renderData.fired=!0,e}spawn(){this.cleanupEventListener=Yt(this,ze.range,$t)}despawn(){var t;(t=this.cleanupEventListener)==null||t.call(this)}updateLinkedAgents(t){this.speedMultiplier=Xt(t),this.damageMultiplier=Ot(t)}getCooldown(){return this.cooldown}getType(){return h.Railgun}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.cooldown=cs,this.isEnabled=!1}isSpeedBoosted(){return this.speedMultiplier>1}isDamageBoosted(){return this.damageMultiplier>1}};let _t=ze;r(_t,"scale",2),r(_t,"range",30);const nr=.015;class rr extends Os{constructor(e,s,i){super();r(this,"entity");r(this,"category",M.Unknown);r(this,"renderData",{});r(this,"time",0);this.source=e,this.target=s,this.damage=i,$s.call(this,nr),this.entity=new V(this.sourceX,this.sourceY,this),this.entity.lookAt(this.targetX,this.targetY),this.source.entity.setRotation(this.entity.getRotation())}tick(e){this.time>=this.travelTime&&(c.Instance.getSurface().despawn(this),this.target.AI.hit(this.damage)),this.time=Math.min(this.time+e,this.travelTime);const s=this.time/this.travelTime;this.entity.setX(wt(this.sourceX,this.targetX,s)),this.entity.setY(wt(this.sourceY,this.targetY,s))}getType(){return h.Bullet}isVisible(){return!0}}const us=500,ar=10,Ke=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"cooldown",0);r(this,"cleanupEventListener");r(this,"hp",50);r(this,"isEnabled",!0);r(this,"speedMultiplier",1);r(this,"damageMultiplier",1);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}tick(t){!this.isEnabled||this.cooldown<=0||(this.cooldown-=t*this.speedMultiplier)}fire(t){this.cooldown+=us;const e=c.Instance.consume(this,this.speedMultiplier,this.damageMultiplier),s=ar*(e?this.damageMultiplier:1),i=new rr(this,t,s);return c.Instance.getSurface().spawn(i),this.renderData.fired=!0,s}spawn(){this.cleanupEventListener=Yt(this,Ke.range,$t)}despawn(){var t;(t=this.cleanupEventListener)==null||t.call(this)}updateLinkedAgents(t){this.speedMultiplier=Xt(t),this.damageMultiplier=Ot(t)}getCooldown(){return this.cooldown}getType(){return h.Tower}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.cooldown=us,this.isEnabled=!1}isSpeedBoosted(){return this.speedMultiplier>1}isDamageBoosted(){return this.damageMultiplier>1}};let Tt=Ke;r(Tt,"scale",2),r(Tt,"range",10);class Ns{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"hp",50);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}getType(){return h.Wall}getTile(){return this.tile}updateTile(t){this.tile=t}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}}r(Ns,"scale",2);const te=250;class or{constructor(t){r(this,"entity");r(this,"category",M.Unknown);r(this,"renderData",{});r(this,"time",0);r(this,"targetX",0);r(this,"targetY",0);this.source=t;const[e,s]=gt(t);this.entity=new V(e,s,this)}dealDamage(t,e){this.time>te&&c.Instance.getSurface().spawn(this),this.time=0,this.targetX=t.entity.getX()+.5,this.targetY=t.entity.getY()+.5;const s=Math.atan2(this.targetY-this.entity.getY(),this.targetX-this.entity.getX());this.entity.setRotation(s*180/Math.PI),this.source.entity.setRotation(this.entity.getRotation()+90),t.AI.hit(e),t.lightOnFire&&t.lightOnFire()}tick(t){this.time+=t,this.time>te&&c.Instance.getSurface().despawn(this)}getType(){return h.LaserBeam}isVisible(){return!0}}const ds=1,lr=.05,qe=class{constructor(t){r(this,"entity");r(this,"category",M.Player);r(this,"cooldown",0);r(this,"cleanupEventListener");r(this,"laserBeam");r(this,"hp",80);r(this,"isEnabled",!0);r(this,"speedMultiplier",1);r(this,"damageMultiplier",1);r(this,"renderData",{});this.tile=t,this.entity=new B(t.getX(),t.getY(),this)}tick(t){!this.isEnabled||this.cooldown<=0||(this.cooldown=Math.max(0,this.cooldown-t))}fire(t,e){if(this.cooldown=ds,!c.Instance.consumeContinuous(this,e,this.damageMultiplier*this.speedMultiplier))return 0;const s=lr*this.damageMultiplier*this.speedMultiplier*e;return this.laserBeam||(this.laserBeam=new or(this),c.Instance.getSurface().spawn(this.laserBeam)),this.laserBeam.dealDamage(t,s),this.renderData.fired=!0,s}spawn(){this.cleanupEventListener=Yt(this,qe.range,$t)}despawn(){var t;(t=this.cleanupEventListener)==null||t.call(this)}updateLinkedAgents(t){this.speedMultiplier=Xt(t),this.damageMultiplier=Ot(t)}getCooldown(){return this.cooldown}getType(){return h.Laser}hit(t){this.hp-=t,this.hp<=0&&c.Instance.getSurface().despawnStatic(this)}isVisible(){return!0}getTile(){return this.tile}updateTile(t){this.tile=t}enable(){this.isEnabled=!0}disable(){this.cooldown=ds,this.isEnabled=!1}isSpeedBoosted(){return this.speedMultiplier>1}isDamageBoosted(){return this.damageMultiplier>1}};let It=qe;r(It,"scale",2),r(It,"range",16);const Us={name:"Fence",description:"A simple fence that land-based enemies have to walk around. If the fence becomes too long however, they will climb over it. Fences are low to towers can shoot over them.",entity:Fs,entityType:h.Fence,htmlElement:"\u{1F945}"},Ws={name:"Wall",description:"A large solid wall that land-based enemies have to walk around. A wall is equivalent to a tower that does not shoot meaning enemies will avoid them but will destroy them if left with no other option.",entity:Ns,entityType:h.Wall,htmlElement:"\u{1F6A7}"},Hs={name:"Electric fence",description:"Electric fences are similar to their normal counterpart but enemies are far less likely to climb over them. If they do they will also continuously receive damage, given that you have enough power stored.",entity:Rs,entityType:h.ElectricFence,htmlElement:"\u26A1"},js={name:"Freezer",description:"A large pad that slows down land-based enemies that walk over it. The pad does not repel or attract enemies so they still have to be guided to walk over it.",entity:Bs,entityType:h.Freezer,htmlElement:"\u2744\uFE0F"},Vs={name:"Tower",description:"The cheapest and most basic tower. It has poor range and deals little damage.",entity:Tt,entityType:h.Tower,htmlElement:"\u{1F5FC}"},Gs={name:"Mortar",description:"A powerful tower with a large range that can shoot over obstacles. It also deals splash damage, hurting all enemies near the impact. Reload speed and travel time of the projectile is slow though.",entity:bt,entityType:h.Mortar,htmlElement:"\u{1F6F0}\uFE0F"},zs={name:"Flamethrower",description:"A turret intended for close range combat. It continuously hurts a single enemy within range. Enemies that were lit on fire will also keep burning for a while.",entity:Mt,entityType:h.Flamethrower,htmlElement:"\u{1F9EF}"},Ks={name:"Railgun",description:"A powerful tower with a large range that can pierce enemies. It shoots relatively fast and deals massive damage to an enemy and all enemies behind it at the cost of consuming power.",entity:_t,entityType:h.Railgun,htmlElement:"\u{1F321}\uFE0F"},Ye={name:"Sell",description:"Sell towers or blueprints. Blueprints and towers placed before the start of a wave are fully refunded. Other towers give back half their original cost when sold.",entityType:h.None,htmlElement:"\u274C"},qs={name:"Radar",description:"A part of your base that exposes a large area in the direction that it was placed in. Exposed enemy bases are immediately neutralized when exposed by a radar.",entity:Xs,entityType:h.Radar,htmlElement:"\u{1F4E1}",isBasePart:!0},Zs={name:"Power plant",description:"A part of your base that generates an amount power at the start of every wave. Power can be stored across waves and is consumed by various towers. More power plants will generate more power but there are diminishing returns.",entity:Ys,entityType:h.PowerPlant,htmlElement:"\u{1F3ED}",isBasePart:!0},Qs={name:"Armory",description:"A part of your base that regenerates hit points at the start of every wave. More armories will regenerate more hit points but there are diminishing returns.",entity:Ds,entityType:h.Armory,htmlElement:"\u{1F3F0}",isBasePart:!0},Js={name:"Market",description:"A part of your base that increases the amount of money you get per killed enemy. More markets will increase the multiplier but there are diminishing returns.",entity:Ls,entityType:h.Market,htmlElement:"\u{1F3EA}",isBasePart:!0},ti={name:"Speed Beacon",description:"A building that increases the reload speed of cardinally adjacent towers at the cost of some power for every shot fired. If there is no power (left) the towers will continue working as normal without a speed boost. Keep in mind that the beacon also blocks tower sight lines.",entity:xt,entityType:h.SpeedBeacon,htmlElement:"\u23F0"},ei={name:"Damage Beacon",description:"A building that increases the damage of cardinally adjacent towers at the cost of some power for every shot fired. If there is no power (left) the towers will continue working as normal without a damage boost. Keep in mind that the beacon also blocks tower sight lines.",entity:kt,entityType:h.DamageBeacon,htmlElement:"\u{1F6A8}"},si={name:"Laser",description:"A reasonably powerful tower that lights enemies on fire, similar to the flamethrower. It has a larger range but consumes power in order to fire.",entity:It,entityType:h.Laser,htmlElement:"\u{1F52D}"},hr={name:"Excavator",description:"Allows building over trees and rocks.",entityType:h.Excavator,htmlElement:"\u{1F69C}",cost:1},cr={name:"Terraform",description:"Allows building over water, ice and enemy structures. Keep in mind a stone foundation is also built which replaces the original surface.",entityType:h.Terraform,htmlElement:"\u{1F3D7}\uFE0F",cost:1},ii=100,ur={name:"Convert",description:`Convert a wave point in a flat ${ii} gold.`,entityType:h.Convert,htmlElement:"\u{1FA99}",isRepeatable:!0,cost:1},ee=1.5,dr={name:"Emerg. recharge",description:`Activate all existing power plants again to generate additional power. This can also be done during a wave, but doing it between waves is ${ee} as efficient.`,entityType:h.EmergencyRecharge,htmlElement:"\u{1F50C}",isRepeatable:!0,cost:2},gr={name:"Emerg. repair",description:`Activate all existing armories again to generate additional base health. This can also be done during a wave, but doing it between waves is ${ee} as efficient.`,entityType:h.EmergencyRepair,htmlElement:"\u{1F6E0}",isRepeatable:!0,cost:3};var Xe=(n=>(n.Construction="Construction",n.Walls="Walls",n.BasicBuildings="Basic buildings",n.PoweredBuildings="Powered Buildings",n.BaseBuildings="Base Buildings",n.WildcardBuildings="Wildcard Buildings",n.Abilities="Abilities",n))(Xe||{});const ni={Construction:[Ye,hr,cr],Walls:[Us,Ws,Hs],["Basic buildings"]:[Vs,zs,Gs],["Powered Buildings"]:[Zs,si,Ks],["Base Buildings"]:[Qs,qs,Js],["Wildcard Buildings"]:[js,ti,ei],Abilities:[ur,dr,gr]},pr=[Ye,Us,Ws,Hs,js,Vs,Gs,zs,Ks,qs,Zs,Qs,Js,ti,ei,si],jt=new Set(pr.map(n=>n.entityType));class Ce{constructor(t,e,s){r(this,"entity");r(this,"category",M.Player);r(this,"renderData",{});this.tile=t,this.placeable=e,this.scaleOverride=s,this.entity=new V(t.getX(),t.getY(),this)}getType(){return h.Blueprint}getTile(){return this.tile}isVisible(){return!0}getPlaceable(){return this.placeable}getScale(){var t;return((t=this.placeable.entity)==null?void 0:t.scale)||this.scaleOverride||1}isDelete(){return this.placeable.entityType===h.None}isBasePart(){return!!this.placeable.isBasePart}}const fr=n=>n.getType()===h.Blueprint,Pt={[h.Fence]:1,[h.Wall]:6,[h.ElectricFence]:9,[h.Freezer]:6,[h.Tower]:14,[h.Flamethrower]:21,[h.Mortar]:50,[h.Railgun]:70,[h.Radar]:50,[h.PowerPlant]:25,[h.Armory]:50,[h.Market]:30,[h.SpeedBeacon]:70,[h.DamageBeacon]:60,[h.Laser]:40},mr=.5;class yr{constructor(t=0,e=()=>1){r(this,"recentlyBought",new Set);this.money=t,this.multiplier=e,c.Instance.addEventListener(k.Unlock,({placeable:s})=>{s.entityType===h.Convert&&(this.addMoney(ii),c.Instance.triggerStatUpdate())})}setMoney(t){this.money=t}addMoney(t){this.money+=t}removeMoney(t){if(t>this.money)throw new Error("Not enough money!");this.money-=t}registerEnemyKill(t){const e=this.getEnemyValue(t)*this.multiplier();this.money+=e}buy(t){var i;let e=t.getType();fr(t)&&(e=t.getPlaceable().entityType);const s=(i=Pt[e])!=null?i:0;if(s>this.money)throw new Error("Not enough money!");this.removeMoney(s),this.recentlyBought.add(t)}replaceBlueprint(t,e){this.recentlyBought.has(t)&&(this.recentlyBought.delete(t),this.recentlyBought.add(e))}sell(t){var e,s;if(t instanceof Ce)this.addMoney((e=Pt[t.getPlaceable().entityType])!=null?e:0);else{const i=(s=Pt[t.getType()])!=null?s:0;this.addMoney(i*(this.recentlyBought.has(t)?1:mr))}}getMoney(){return this.money}getMultiplier(){return this.multiplier()}clearRecents(){this.recentlyBought.clear()}isRecent(t){return this.recentlyBought.has(t)}getEnemyValue(t){switch(t.getType()){case h.Slime:case h.Tank:return 5;case h.Runner:return 3;case h.Flier:return 6;default:throw new Error("Entity is not an enemy")}}}const xe={[h.ElectricFence]:.05,[h.Railgun]:5,[h.Laser]:.004},wr=2,gs=1.25;class vr{constructor(){r(this,"generators",new Set);r(this,"consumption",0);r(this,"blackout",!1);r(this,"power",0)}registerGenerator(t){this.generators.add(t)}removeGenerator(t){this.generators.delete(t)}getProduction(){return c.Instance.getBase().getPartsCount(h.PowerPlant)*5}getConsumption(){return this.consumption}consume(t){return t===0?!0:this.blackout?!1:(this.power-=t,this.power<0?(this.power=0,this.blackout=!0,c.Instance.triggerEvent(k.BlackOut),c.Instance.triggerStatUpdate(),!1):(this.consumption+=t,!0))}processPower(t=1){this.power=this.power+this.getProduction()*t,this.blackout=!1,this.power<0&&c.Instance.triggerEvent(k.BlackOut),c.Instance.getIsStarted()||(this.consumption=0)}getPower(){return this.power}}const Oe=n=>(Rt("data-v-fd3cbd3e"),n=n(),Ft(),n),Er={class:"sprite"},Sr={class:"name"},Mr={key:0,class:"lock"},br={class:"data"},_r={key:0},Tr=Oe(()=>w("span",{class:"emoji"},"\u{1FA99}",-1)),Ir={key:1},Ar=Oe(()=>w("span",{class:"emoji"},"\u{1F4D0}",-1)),Cr={key:2},xr={key:3},kr={key:4},Pr={key:5},Dr=Oe(()=>w("span",{class:"emoji"},"\u{1F6A9}",-1)),Rr=Z({__name:"Placeable",props:{item:null,locked:{type:Boolean},onSelect:null,selected:{type:Boolean}},setup(n){const t=n,e=Pt[t.item.entityType],s=t.item.entity&&t.item.entity.range;return(i,a)=>(S(),_("button",{class:U({placeable:!0,"placeable--locked":t.locked,"placeable--selected":t.selected}),onClick:a[0]||(a[0]=o=>t.onSelect(n.item))},[w("span",Er,R(t.item.htmlElement),1),w("span",Sr,[D(R(t.item.name)+" ",1),t.locked?(S(),_("span",Mr,"\u{1F512}")):Y("",!0)]),w("ul",br,[x(e)?(S(),_("li",_r,[Tr,D(" "+R(x(e)),1)])):Y("",!0),x(s)?(S(),_("li",Ir,[Ar,D(" "+R(x(s)),1)])):Y("",!0),x(xe)[t.item.entityType]?(S(),_("li",Cr,"\u26A1")):Y("",!0),t.item.isBasePart?(S(),_("li",xr,"\u{1F9F1}")):Y("",!0),t.item.isRepeatable?(S(),_("li",kr,"\u267B")):Y("",!0),t.item.cost?(S(),_("li",Pr,[Dr,D(" "+R(t.item.cost),1)])):Y("",!0)])],2))}});const J=(n,t)=>{const e=n.__vccOpts||n;for(const[s,i]of t)e[s]=i;return e},Fr=J(Rr,[["__scopeId","data-v-fd3cbd3e"]]),Br={class:"marketplace"},Lr={class:"info"},Yr={class:"description"},Xr={class:"section"},Or=["disabled"],$r={class:"grid"},Nr={class:"column"},Ur={class:"header"},Wr={class:"item"},Hr=Z({__name:"Marketplace",props:{controller:null,unlocksController:null,manager:null},setup(n){const t=n,e=T(t.controller.getPlacable()),s=T(!1),i=vs();let a,o;Bt(()=>{a=t.manager.addEventListener(k.OpenBuildMenu,()=>s.value=!0),o=t.manager.addEventListener(k.CloseBuildMenu,()=>s.value=!1)}),re(()=>{a&&o&&(a(),o())});const l=g=>{e.value=g,t.controller.setPlaceable(g)},u=Object.values(Xe),p=()=>{t.unlocksController.unlock(e.value),i.proxy.$forceUpdate()},y=()=>{t.controller.toggleBuildMenu()};return(g,f)=>(S(),_("div",{class:U({"marketplace-wrapper":!0,"marketplace-wrapper--visible":s.value})},[w("div",Br,[w("div",Lr,[w("p",Yr,R(e.value?e.value.description:"Select a tower below."),1),w("div",Xr,[D(R(t.manager.getUnlocksController().getPoints())+" wave points ",1),e.value&&(!t.unlocksController.isUnlocked(e.value)||e.value.isRepeatable)?(S(),_("button",{key:0,disabled:!t.unlocksController.canUnlock(e.value),onClick:p}," Unlock "+R(e.value.name),9,Or)):Y("",!0)]),w("button",{onClick:y,class:"close-button"},"\u2716")]),w("div",$r,[(S(!0),_(nt,null,Dt(x(u),E=>(S(),_("div",Nr,[w("div",Ur,R(E),1),(S(!0),_(nt,null,Dt(x(ni)[E],v=>{var I;return S(),_("div",Wr,[C(Fr,{item:v,locked:!t.unlocksController.isUnlocked(v),selected:((I=e.value)==null?void 0:I.entityType)===v.entityType,onSelect:l},null,8,["item","locked","selected"])])}),256))]))),256))])])],2))}});const jr=J(Hr,[["__scopeId","data-v-c893ebea"]]),Vr={class:"stats"},Gr={class:"meta"},zr={class:"positive"},Kr={class:"meta"},qr={class:"positive"},Zr={class:"negative"},Qr={class:"meta"},Jr={class:"positive"},ta=Z({__name:"Stats",props:{expanded:{type:Boolean}},setup(n){const t=n,e=Intl.NumberFormat(void 0,{maximumFractionDigits:0}),s=Intl.NumberFormat(void 0,{maximumFractionDigits:2}),i=Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:0}),a=T(0),o=T(0),l=T(0),u=T(0),p=T(!1),y=T(0),g=T(0),f=T(0),E=T(0),v=T(0),I=b=>{a.value=b.money,o.value=b.moneyMultiplier,l.value=b.level,u.value=b.remainingEnemies,p.value=b.inProgress,y.value=b.integrity,g.value=b.regeneration,f.value=b.power,E.value=b.production,v.value=b.consumption},A=Ai(()=>({stat:!0,"stat--expanded":t.expanded}));return Bt(()=>{c.Instance.addEventListener(k.StatUpdate,I),c.Instance.triggerStatUpdate()}),re(()=>{c.Instance.removeEventListener(k.StatUpdate,I)}),(b,X)=>(S(),_("div",Vr,[w("span",{class:U(x(A))},[D(" \u{1FA99} "+R(x(e).format(a.value))+" ",1),w("span",Gr,[D("("),w("span",zr,R(x(i).format(o.value)),1),D(")")])],2),w("span",{class:U(x(A))},[D(" \u{1F50B} "+R(x(e).format(f.value))+" ",1),w("span",Kr,[D("("),w("span",qr,"+"+R(x(s).format(E.value)),1),D("/"),w("span",Zr,"-"+R(x(s).format(v.value)),1),D(")")])],2),w("span",{class:U(x(A))},[D(" \u{1F6E1}\uFE0F "+R(x(e).format(y.value))+" ",1),w("span",Qr,[D("("),w("span",Jr,"+"+R(x(s).format(g.value)),1),D(")")])],2),w("span",{class:U(x(A))}," \u{1F47E} "+R(u.value),3)]))}});const ea=J(ta,[["__scopeId","data-v-05c1e3d4"]]),sa=n=>(Rt("data-v-a4e9dd64"),n=n(),Ft(),n),ia={class:"hud"},na={class:"hud-positioner"},ra={class:"group"},aa=sa(()=>w("span",{class:"emoji"},"\u2694\uFE0F",-1)),oa={key:0},la={key:1},ha=Z({__name:"Hud",props:{renderer:null,controller:null},setup(n){const t=n,e=T(0),s=T(!1),i=T(!1),a=T(!1),o=y=>{e.value=y.level,s.value=y.inProgress};Bt(()=>{c.Instance.addEventListener(k.StatUpdate,o),c.Instance.triggerStatUpdate()}),re(()=>{c.Instance.removeEventListener(k.StatUpdate,o)});function l(){c.Instance.start()}function u(){a.value=!a.value}function p(){i.value?t.renderer.hideCoverage():t.renderer.showCoverage(),c.Instance.triggerEvent(k.ToggleShowCoverage),i.value=!i.value}return(y,g)=>(S(),_("div",ia,[w("div",na,[C(ea,{expanded:a.value},null,8,["expanded"]),w("div",ra,[w("button",{class:U({"wave-toggle":!0,"wave-toggle--active":!s.value}),onClick:l},[aa,s.value?Y("",!0):(S(),_("span",oa,"Start wave "+R(e.value+1),1)),s.value?(S(),_("span",la,"Wave "+R(e.value),1)):Y("",!0)],2),w("button",{class:"toggle",onClick:g[0]||(g[0]=(...f)=>t.controller.toggleBuildMenu&&t.controller.toggleBuildMenu(...f))}," \u{1F527} "),w("button",{class:U({toggle:!0,"toggle-toggled":a.value}),onClick:u}," \u{1F50E} ",2),x(c).Instance.getDifficulty()!==x($).Hard?(S(),_("button",{key:0,class:U({toggle:!0,"toggle-toggled":i.value}),onClick:p}," \u{1F3AF} ",2)):Y("",!0)])])]))}});const ca=J(ha,[["__scopeId","data-v-a4e9dd64"]]),Vt=(n,t,e,s)=>{const i=e.getTile(),a=new Set([i]),o=s.getAdjacentTiles(i,2);for(;o.length>0;){const l=o.pop();n.has(l)||a.has(l)||!t.has(l)&&(!l.hasStaticEntity()||!e.getParts().has(l.getStaticEntity().getAgent()))||(a.add(l),s.getAdjacentTiles(l,2).forEach(u=>o.push(u)))}return a.size===e.getParts().size+t.size-n.size},Gt=2e3,it=new Set([h.Armory,h.Radar,h.Market,h.PowerPlant]),ua=new Set([d.Water,d.Ice,d.Spore,d.Bridge]);class da{constructor(t){r(this,"blueprints",new Map);r(this,"pendingBaseAdditions",[]);r(this,"pendingBaseRemovals",[]);r(this,"freeTiles");r(this,"ignoredEntities");this.surface=t,this.freeTiles=new Set(Re),this.ignoredEntities=new Set,c.Instance.addEventListener(k.Unlock,({placeable:e})=>{e.entityType===h.Excavator&&(this.freeTiles.add(d.Tree),this.freeTiles.add(d.Rock),this.ignoredEntities.add(h.Tree),this.ignoredEntities.add(h.Rock)),e.entityType===h.Terraform&&(this.freeTiles.add(d.Water),this.freeTiles.add(d.Ice),this.freeTiles.add(d.Spore),this.freeTiles.add(d.Bridge))})}build(t,e){if(e.entityType===h.None){c.Instance.getIsStarted()?this.sellBlueprints(t):this.sellEntities(t);return}!jt.has(e.entityType)||!c.Instance.getUnlocksController().isUnlocked(e)||(c.Instance.getIsStarted()?this.placeBlueprints(t,e):this.placeEntities(t,e))}commit(){this.blueprints.forEach(t=>{const e=t.getTile(),s=this.surface.getEntityTiles(e.getX(),e.getY(),t.getScale());if(this.surface.despawn(t),s.forEach(o=>{if(!o.hasStaticEntity())return;const l=o.getStaticEntity().getAgent();c.Instance.getMoneyController().sell(l),this.surface.despawnStatic(l)}),t.isDelete())return;const i=t.getPlaceable().entity,a=new i(e);this.spawn(a),c.Instance.getMoneyController().replaceBlueprint(t,a)}),this.blueprints.clear(),this.pendingBaseAdditions=[],this.pendingBaseRemovals=[],c.Instance.triggerStatUpdate()}placeBlueprints(t,e){const s=t.filter(i=>this.checkIsFree(i,e.entity.scale,!0));if(e.isBasePart){const{pendingBaseAdditions:i,pendingBaseRemovals:a}=this.getPendingTiles(t);if(!Vt(a,i,c.Instance.getBase(),this.surface))return c.Instance.showMessage("Not all tiles connect to the base",{expires:Gt}),[]}if(!c.Instance.canBuy(e,s.length))return[];s.forEach(i=>{this.surface.getEntityTiles(i.getX(),i.getY(),e.entity.scale).forEach(l=>{const u=this.blueprints.get(l.getHash());!u||(c.Instance.getMoneyController().sell(u),this.freeBlueprint(u),u.isBasePart()?this.pendingBaseAdditions.splice(this.pendingBaseAdditions.indexOf(u),1):l.hasStaticEntity()&&it.has(l.getStaticEntity().getAgent().getType())&&this.pendingBaseRemovals.splice(this.pendingBaseRemovals.indexOf(u),1),u.isDelete()&&l.hasStaticEntity()&&it.has(l.getStaticEntity().getAgent().getType())&&this.pendingBaseRemovals.splice(this.pendingBaseRemovals.indexOf(u),1))});const o=new Ce(i,e);c.Instance.getMoneyController().buy(o),this.reserveBlueprint(o),e.isBasePart&&(!i.hasStaticEntity()||!it.has(i.getStaticEntity().getAgent().getType()))&&this.pendingBaseAdditions.push(o)}),c.Instance.triggerStatUpdate()}sellBlueprints(t){const e=t.find(o=>this.blueprints.has(o.getHash()));let s=t.filter(o=>e?!!this.blueprints.has(o.getHash()):!!(o.hasStaticEntity()&&jt.has(o.getStaticEntity().getAgent().getType())));const{baseTiles:i,otherTiles:a}=this.splitTiles(s);if(i.length){const{pendingBaseAdditions:o,pendingBaseRemovals:l}=this.getPendingTiles(i,!0);Vt(l,o,c.Instance.getBase(),this.surface)||(s=a,c.Instance.showMessage("Not all base parts can be sold",{expires:Gt}))}s.forEach(o=>{if(e){const l=this.blueprints.get(o.getHash());l&&(l.isDelete()||(c.Instance.getMoneyController().sell(l),o.hasStaticEntity()&&it.has(o.getStaticEntity().getAgent().getType())&&this.pendingBaseRemovals.splice(this.pendingBaseRemovals.indexOf(l),1)),l.isBasePart()&&(!o.hasStaticEntity()||!it.has(o.getStaticEntity().getAgent().getType()))&&this.pendingBaseAdditions.splice(this.pendingBaseAdditions.indexOf(l),1),this.freeBlueprint(l),o.hasStaticEntity()&&it.has(o.getStaticEntity().getAgent().getType())&&this.pendingBaseRemovals.splice(this.pendingBaseRemovals.indexOf(l),1));return}if(o.hasStaticEntity()&&!this.blueprints.get(o.getHash())){const l=o.getStaticEntity().getAgent(),u=new Ce(l.getTile(),Ye,rt(l));this.reserveBlueprint(u),it.has(l.getType())&&this.pendingBaseRemovals.push(u)}}),c.Instance.triggerStatUpdate()}placeEntities(t,e){const s=t.filter(i=>this.checkIsFree(i,e.entity.scale));if(e.isBasePart&&!Vt(new Set,new Set(s),c.Instance.getBase(),this.surface))return c.Instance.showMessage("Not all tiles connect to the base",{expires:Gt}),[];if(!c.Instance.canBuy(e,s.length))return[];s.forEach(i=>{const a=new e.entity(i);this.surface.getEntityTiles(a).map(o=>{o.hasStaticEntity()&&this.surface.despawnStatic(o.getStaticEntity().getAgent())}),this.spawn(a),c.Instance.getMoneyController().buy(a)}),c.Instance.triggerStatUpdate()}sellEntities(t){let e=t.filter(a=>!!(a.hasStaticEntity()&&jt.has(a.getStaticEntity().getAgent().getType())));const{baseTiles:s,otherTiles:i}=this.splitTiles(e);if(s.length){const{pendingBaseAdditions:a,pendingBaseRemovals:o}=this.getPendingTiles(s,!0);Vt(o,a,c.Instance.getBase(),this.surface)||(e=i,c.Instance.showMessage("Not all base parts can be sold",{expires:Gt}))}e.forEach(a=>{if(a.hasStaticEntity()){const o=a.getStaticEntity().getAgent();this.surface.despawnStatic(o),c.Instance.getMoneyController().sell(o)}}),c.Instance.triggerStatUpdate()}splitTiles(t){const e=new Set,s=[];return t.forEach(i=>{const a=this.blueprints.get(i.getHash());if(a&&a.isBasePart()){e.add(a.getTile());return}i.hasStaticEntity()&&it.has(i.getStaticEntity().getAgent().getType())?e.add(i.getStaticEntity().getAgent().getTile()):s.push(i)}),{baseTiles:[...e],otherTiles:s}}getPendingTiles(t,e=!1){const s=new Set(this.pendingBaseAdditions.map(o=>this.surface.getTile(o.entity.getAlignedX(),o.entity.getAlignedY()))),i=new Set(this.pendingBaseRemovals.map(o=>this.surface.getTile(o.entity.getAlignedX(),o.entity.getAlignedY())));let a=o=>{s.delete(o)||i.delete(o)||i.add(o)};return t.forEach(o=>{if(e){a(o);return}const l=this.blueprints.get(o.getHash());if(l){if(l.isDelete()){i.delete(o);return}s.add(o);return}s.add(o)}),{pendingBaseAdditions:s,pendingBaseRemovals:i}}checkIsFree(t,e,s=!1){return!this.surface.getEntityTiles(t.getX(),t.getY(),e).find(a=>{if(!this.freeTiles.has(a.getBaseType())||a.hasStaticEntity()&&!this.ignoredEntities.has(a.getStaticEntity().getAgent().getType())&&(!s||!jt.has(a.getStaticEntity().getAgent().getType())))return!0})}reserveBlueprint(t){this.surface.spawn(t);const e=t.getTile();this.surface.getEntityTiles(e.getX(),e.getY(),t.getScale()).forEach(s=>this.blueprints.set(s.getHash(),t))}freeBlueprint(t){this.surface.despawn(t);const e=t.getTile();this.surface.getEntityTiles(e.getX(),e.getY(),t.getScale()).forEach(s=>this.blueprints.delete(s.getHash()))}spawn(t){this.surface.getEntityTiles(t).forEach(e=>{ua.has(e.getBaseType())&&this.surface.setTile(new z(e.getX(),e.getY(),d.Stone))}),this.surface.spawnStatic(t)}}class ga{constructor(){r(this,"unlockedTowers");r(this,"availableUnlocks");r(this,"unlockLinkedMap");r(this,"points",0);this.unlockedTowers=new Set,this.availableUnlocks=new Set,this.unlockLinkedMap=new Map,Object.values(Xe).forEach(t=>{const e=ni[t];e.forEach((s,i)=>{if(i===0){this.availableUnlocks.add(s.entityType),this.unlockedTowers.add(s.entityType);return}this.unlockedTowers.has(e[i-1].entityType)&&(this.availableUnlocks.add(s.entityType),s.isRepeatable&&this.unlockedTowers.add(s.entityType)),e.length>i+1&&this.unlockLinkedMap.set(s.entityType,e[i+1])})})}addPoint(){this.points++}getPoints(){return this.points}canUnlock(t){var e;return this.availableUnlocks.has(t.entityType)&&this.points>=((e=t.cost)!=null?e:1)}isUnlocked(t){return this.unlockedTowers.has(t.entityType)}unlock(t){var e;if(!this.canUnlock(t))throw new Error(`Can't unlock ${t.entityType}`);this.points-=(e=t.cost)!=null?e:1,this.makeAvailable(t),c.Instance.triggerEvent(k.Unlock,{placeable:t})}makeAvailable(t){this.unlockedTowers.add(t.entityType),t.isRepeatable||this.availableUnlocks.delete(t.entityType);const e=this.unlockLinkedMap.get(t.entityType);e&&(this.availableUnlocks.add(e.entityType),e.isRepeatable&&this.makeAvailable(e))}}class pa extends c{constructor(e,s,i,a,o){super(e,s,i,a,o);r(this,"showMessage",(...e)=>this.messageFn(...e));r(this,"onUnlock",({placeable:e})=>{const s=this.getIsStarted();e.entityType===h.EmergencyRecharge&&this.powerController.processPower(s?1:ee),e.entityType===h.EmergencyRepair&&this.base.regenerate(s?1:ee)});this.powerController=new vr,this.moneyController=new yr(150,()=>Math.max(.5,this.base.getMoneyFactor()-this.waveController.getLevel()/120)),this.buildController=new da(i),this.unlocksController=new ga,this.surface.getEntityTiles(this.base).map(l=>{l.hasStaticEntity()&&this.surface.despawnStatic(l.getStaticEntity().getAgent())}),i.spawnStatic(this.base),this.addEventListener(k.Unlock,this.onUnlock),console.log(this)}tick(e){if(this.surface.processChangedTiles(),this.base.isDestroyed())return;const s=this.surface.getEntities();for(let a of s)a.getAgent().tick&&a.getAgent().tick(e);const i=this.surface.getStaticEntities();for(let a of i)a.getAgent().tick&&a.getAgent().tick(e);this.waveController.tick(e)}triggerStatUpdate(){const e=this.getSurface().getEntitiesForCategory(M.Enemy).size;this.triggerEvent(k.StatUpdate,{integrity:this.base.getHp(),regeneration:this.base.getRegenerationFactor(),level:this.waveController.getLevel(),money:this.moneyController.getMoney(),moneyMultiplier:this.moneyController.getMultiplier(),production:this.powerController.getProduction(),consumption:this.powerController.getConsumption(),power:this.powerController.getPower(),remainingEnemies:e,inProgress:this.getIsStarted()})}spawnEnemy(e){this.surface.spawn(e),this.triggerStatUpdate()}despawnEnemy(e){this.surface.despawn(e)&&(this.moneyController.registerEnemyKill(e),this.waveController.processWave()?this.end():this.triggerStatUpdate())}getSurface(){return this.surface}getController(){return this.controller}getVisibilityController(){return this.visibilityController}getPowerController(){return this.powerController}getBuildController(){return this.buildController}getMoneyController(){return this.moneyController}getUnlocksController(){return this.unlocksController}getWaveController(){return this.waveController}getBase(){return this.base}getIsStarted(){return this.waveController.isWaveInProgress()}canBuy(e,s=1){var a;const i=((a=Pt[e.entityType])!=null?a:0)*s;return i>this.moneyController.getMoney()?(this.showMessage(`You do not have enough money. This costs \u{1FA99} ${i}`),!1):!0}start(){if(this.getIsStarted())throw new Error("Wave already in progress!");this.triggerEvent(k.StartWave),this.powerController.processPower(),this.moneyController.clearRecents(),this.visibilityController.commit(),this.waveController.startNewWave(),this.triggerStatUpdate(),c.Instance.getSurface().forceRerender()}consume(e,s=1,i=1){var a;return this.powerController.consume(((a=xe[e.getType()])!=null?a:0)+(s-1)*wr+(i-1)*gs)}consumeContinuous(e,s,i=1){var a;return this.powerController.consume(((a=xe[e.getType()])!=null?a:0)*s+(i-1)*gs*s/16)}getDifficulty(){return this.difficulty}getIsBaseDestroyed(){return this.base.isDestroyed()}end(){this.buildController.commit(),this.base.regenerate(),this.unlocksController.addPoint(),this.visibilityController.updateBaseRange(),this.triggerStatUpdate(),this.triggerEvent(k.EndWave),c.Instance.getSurface().forceRerender()}getDamageMultiplier(){let e=1;switch(this.difficulty){case $.Hard:e+=.2;case $.Normal:e+=.2}return e}}const fa=n=>(Rt("data-v-df3b2a4c"),n=n(),Ft(),n),ma={class:"wrapper"},ya={height:"0",style:{position:"absolute"}},wa=fa(()=>w("defs",null,[w("radialGradient",{id:"alert"},[w("stop",{offset:"0%","stop-color":"red","stop-opacity":"0"}),w("stop",{offset:"95%","stop-color":"red","stop-opacity":"0"}),w("stop",{offset:"100%","stop-color":"red","stop-opacity":"0.8"})])],-1)),va=[wa],Ea={class:"canvas"},Sa=Z({__name:"Game",props:{seed:null,difficulty:null,renderer:null},setup(n){const t=n,e=T(null),s=new Xn(200,200,Yn(t.seed)),i=new $n(s),a=new t.renderer(s,i),o=s.getTile(100,100),l=new pa(t.difficulty,o,s,i,a.showMessage);new Vn().start();let p=!1,y=0;return Bt(()=>{p=!0,a.mount(e.value);const g=f=>{const E=+i.isKeyDown(N.Right)+ +i.isKeyDown(N.D)-+i.isKeyDown(N.Left)-+i.isKeyDown(N.A)-+i.isKeyDown(N.Q),v=+i.isKeyDown(N.Down)+ +i.isKeyDown(N.S)-+i.isKeyDown(N.Up)-+i.isKeyDown(N.W)-+i.isKeyDown(N.Z),I=+i.isKeyDown(N.Plus)+ +i.isKeyDown(N.Equals)-+i.isKeyDown(N.Minus);(E||v||I)&&a.move({x:E,y:v,zoom:I});const A=f-y;l.tick(A),a.rerender(A),y=f,p&&window.requestAnimationFrame(g)};window.requestAnimationFrame(g)}),re(()=>p=!1),(g,f)=>(S(),_("div",ma,[(S(),_("svg",ya,va)),C(ca,{renderer:x(a),controller:x(l).getController()},null,8,["renderer","controller"]),w("div",Ea,[w("div",{class:"render-target",ref_key:"canvas",ref:e},null,512),C(jr,{controller:x(l).getController(),unlocksController:x(l).getUnlocksController(),manager:x(l)},null,8,["controller","unlocksController","manager"])])]))}});const Ma=J(Sa,[["__scopeId","data-v-df3b2a4c"]]);var qt=(n=>(n[n.Growing=0]="Growing",n[n.Fixed=1]="Fixed",n))(qt||{});class me{constructor(t,e=0,s=10){r(this,"size");r(this,"freeEntities",[]);r(this,"usedEntities",new Map);this.initializer=t,this.type=e,this.size=s;for(let i=0;i<s;i++)this.freeEntities.push(t(!1))}get(t){let e=this.usedEntities.get(t);if(e)return e;if(this.freeEntities.length===0){if(this.type===1)throw new Error("Pool is empty");this.size++}return e=this.initializer(!0,this.freeEntities.pop(),t),this.usedEntities.set(t,e),e}free(t){if(!this.usedEntities.has(t))return;let e=this.usedEntities.get(t);return this.usedEntities.delete(t),this.freeEntities.push(e),e}getSize(){return this.size}getUsed(){return this.usedEntities}}const ba=(n,t,e)=>{const s=t.entity,i=s.getX(),a=s.getY(),o=Math.sqrt((i-t.targetX)**2+(a-t.targetY)**2);e.style.transformOrigin="0 0",e.style.opacity=`${1-.9*(t.time/Le)}`,e.style.transform=`translate(${i*n.xStep}px, ${a*n.yStep}px) rotate(${s.getRotation()}deg) scale(${o}, 0.1)`},_a=(n,t,e)=>{const s=t.entity;e.style.opacity=`${1-.9*(t.time/Ae)}`,e.style.transform=`translate(${(s.getX()+Math.random()*.3-.15)*n.xStep}px, ${(s.getY()+Math.random()*.3-.15)*n.yStep}px) rotate(${-s.getRotation()+180+Math.random()*10-5}deg)`},ps=1/4,ye=(n,t,e)=>{const s=t.entity,i=s.getId()%13/26-ps,a=(s.getId()+5)%17/34-ps,o=n.getTime()%13/3;let l=s.getRotation();t.AI.isBusy()&&(l+=Math.sin(n.getTime()%vt/vt*5)*20),t.getStatus()===P.OnFire?(e.style.color="transparent",e.style.textShadow=`${Math.random()-.5}px ${Math.random()-.5}px ${o+2}px #E25822`):t.getStatus()===P.Normal&&(e.style.color="initial",e.style.textShadow="none"),e.style.transform=`translate(${(s.getX()+i)*n.xStep}px, ${(s.getY()+a)*n.yStep}px) rotate(${l}deg)`},Ta=1/4,Ia=1/8,Aa=.0015,Ca=(n,t,e)=>{const s=t.entity,i=Aa*(1+s.getId()%13/13),a=Math.sin((n.getTime()+s.getId())*i)/4-Ia,o=Math.cos((n.getTime()+s.getId())*i)/2-Ta,l=n.getTime()%13/3,u=(s.getRotation()+360)%360,p=u>0&&u<180?-1:1;let y=0;t.AI.isBusy()&&(y+=Math.sin(n.getTime()%vt/vt*5)*20),t.getStatus()===P.OnFire?(e.style.color="transparent",e.style.textShadow=`${Math.random()-.5}px ${Math.random()-.5}px ${l+2}px #E25822`):t.getStatus()===P.Normal&&(e.style.color="initial",e.style.textShadow="none"),e.style.transform=`translate(${(s.getX()+a)*n.xStep}px, ${(s.getY()+o)*n.yStep}px) rotate(${y}deg) scale(${p},1)`},xa=(n,t,e)=>{const s=t.entity;e.children[0].textContent=n.getStaticEntityEmoji(t.getPlaceable().entityType),e.style.transformOrigin="0 0",e.style.opacity="0.5",e.style.filter="grayscale(0.6)",e.style.transform=`translate(${s.getX()*n.xStep}px, ${s.getY()*n.yStep}px) rotate(${s.getRotation()}deg) scale(${t.getScale()})`},ka=(n,t,e)=>{const s=t.entity,i=s.getX(),a=s.getY(),o=Math.sqrt((i-t.targetX)**2+(a-t.targetY)**2);e.style.color="transparent",e.style.textShadow="0 0 0 #E25822",e.style.transformOrigin="0 0",e.style.opacity=`${1-.9*(t.time/te)}`,e.style.transform=`translate(${i*n.xStep}px, ${a*n.yStep}px) rotate(${s.getRotation()}deg) scale(${o}, 0.1)`},we=(n,t,e)=>{const s=t.entity;e.style.transform=`translate(${(s.getX()-.5)*n.xStep}px, ${(s.getY()-.5)*n.yStep}px) rotate(${s.getRotation()}deg)`},Pa={[h.Rail]:ba,[h.Flame]:_a,[h.Slime]:ye,[h.Runner]:ye,[h.Flier]:Ca,[h.Tank]:ye,[h.Blueprint]:xa,[h.LaserBeam]:ka,[h.Bullet]:we,[h.Rocket]:we,[h.Shockwave]:we},Da=Z({__name:"Key",props:{char:null,area:null},setup(n){const t=n,e=t.char>"A"&&t.char<"z";return(s,i)=>(S(),_("div",{class:U({key:!0,emoji:!x(e)}),style:Ci({gridArea:t.area})},R(t.char),7))}});const F=J(Da,[["__scopeId","data-v-8be0d2b3"]]),Ra=Z({__name:"mouse",props:{button:null},setup(n){const t=n;return(e,s)=>(S(),_("div",{class:U(`mouse button-${t.button}`)},null,2))}});const Zt=J(Ra,[["__scopeId","data-v-135d4a7c"]]),Fa=Z({__name:"TextWithControls",props:{text:null},setup(n){const t=n,e={0:"left",1:"right",3:"middle"},s=T(t.text),i=T(""),a=T(""),o=T("");return xi(()=>t.text,l=>{const p=/^(?<left>.*?){(?<control>key|mouse): (?<type>.*?)}(?<right>.*)$/.exec(l);p?(s.value=p.groups.left,i.value=p.groups.control,a.value=p.groups.type,o.value=p.groups.right):(s.value=l,i.value="",a.value="",o.value="")},{immediate:!0}),(l,u)=>{const p=ki("TextWithControls",!0);return S(),_(nt,null,[D(R(s.value)+" ",1),i.value==="key"?(S(),At(F,{key:0,char:a.value},null,8,["char"])):Y("",!0),i.value==="mouse"?(S(),At(Zt,{key:1,button:x(e)[a.value]},null,8,["button"])):Y("",!0),o.value?(S(),At(p,{key:2,text:o.value},null,8,["text"])):Y("",!0)],64)}}}),Ba={class:"message-wrapper"},La={class:"message-inner"},Ya=["onClick"],Xa=Z({__name:"SimpleMessage",props:{register:null},setup(n){const t=n;let e=1;const s=()=>({id:e++,content:"",closable:!0,open:!1,removing:!1}),i=T([s()]),a=T(new Map),o=vs(),l=(p,y)=>{var E;let g,f=-1;if(y!=null&&y.override&&(f=i.value.findIndex(v=>v.id===y.override)),f!==-1){const v=i.value[f].id;window.clearTimeout(a.value.get(v)),a.value.delete(v),g=i.value[f]}else g=i.value.at(-1),i.value.push(s());if(g.closable=(E=y==null?void 0:y.closable)!=null?E:!0,g.open=!0,g.content=p,y!=null&&y.expires){const v=window.setTimeout(()=>{u(g)},y.expires);a.value.set(g.id,v)}return Promise.resolve(g.id)},u=p=>{p.open=!1,p.removing=!0,o.proxy.$forceUpdate(),window.setTimeout(()=>{i.value.splice(i.value.indexOf(p),1)},700)};return Bt(()=>{t.register(l)}),(p,y)=>(S(),_("div",Ba,[(S(!0),_(nt,null,Dt(i.value,g=>(S(),_("div",{key:g.id,class:U({message:!0,"message--visible":g.open,"message--removing":g.removing})},[w("div",La,[g.closable?(S(),_("button",{key:0,class:"close-button",onClick:()=>u(g)}," \u2716 ",8,Ya)):Y("",!0),C(Fa,{text:g.content},null,8,["text"])])],2))),128))]))}});const ri=J(Xa,[["__scopeId","data-v-8a80583d"]]),O=navigator.appVersion.indexOf("Win")!=-1,Oa=42,$a=4,Na=20;let pt=!1;class ai{constructor(t,e){r(this,"pool");r(this,"selectionPool");r(this,"scaledTilesPool");r(this,"messageFn");r(this,"resolveMessageFn");r(this,"xStep",0);r(this,"yStep",0);r(this,"offsetX",0);r(this,"offsetY",0);r(this,"time",0);r(this,"fontSize",Na);r(this,"hasMoved",!1);r(this,"_showCoverage",!1);r(this,"target",null);r(this,"world",null);r(this,"rows",[]);r(this,"alertRanges",[]);r(this,"coverageMap",null);r(this,"coverageRows",[]);r(this,"showMessage",async(...t)=>(await this.messageFn)(...t));r(this,"getEmoji",t=>{const e=pt||c.Instance.getIsBaseDestroyed();if(t.getDiscoveryStatus()===L.Pending&&!e)return"\u{1F50D}";if(!t.isDiscovered()&&!e)return"&nbsp;";if(t.hasStaticEntity()&&rt(t.getStaticEntity().getAgent())!==2)return this.getStaticEntityEmoji(t.getStaticEntity().getAgent().getType());switch(t.getBaseType()){case d.Water:return"\u{1F7E6}";case d.Stone:return"\u2B1C";case d.Grass:return"\u{1F7E9}";case d.Spore:return"\u{1F7EA}";case d.Bridge:return"\u{1F4DC}";case d.Sand:return"\u{1F7E8}";case d.Snow:return"\u{1F32B}\uFE0F";case d.Dirt:return"\u{1F7EB}";case d.Ice:return"\u{1F9CA}";default:return"&nbsp;"}});this.surface=t,this.controller=e,this.pool=new me((s,i,a)=>{if(i)return i.style.display="block",i.style.opacity="1",i.style.transformOrigin="50% 50%",i.style.filter="none",i.style.color="initial",i.style.textShadow="none",i.children[0].textContent=this.getEntityEmoji(a),i;const o=document.createElement("span");return o.appendChild(document.createElement("span")),O&&(o.children[0].style.margin="-0.35ch"),o.children[0].textContent=a?this.getEntityEmoji(a):"",o.style.position="absolute",o.style.top=O?"-.125ch":"-.075ch",o.style.left=O?".35ch":"0",o.style.display=s?"block":"none",o.style.willChange="transform",this.world.appendChild(o),o},qt.Growing,0),this.selectionPool=new me((s,i)=>{if(i)return i.style.display="block",i;const a=document.createElement("span");return a.appendChild(document.createElement("span")),O&&(a.children[0].style.margin="-0.35ch"),a.children[0].textContent="\u{1F7E7}",a.style.transformOrigin="0 0",a.style.opacity="0.7",a.style.position="absolute",a.style.top=O?"-.125ch":"-.075ch",a.style.left=O?".35ch":"0",a.style.display=s?"block":"none",a.style.willChange="transform",this.world.appendChild(a),a},qt.Growing,0),this.scaledTilesPool=new me((s,i,a)=>{if(i)return i.style.display="block",i.children[0].textContent=this.getStaticEntityEmoji(a.getAgent().getType()),i;const o=document.createElement("span");return o.appendChild(document.createElement("span")),O&&(o.children[0].style.margin="-0.35ch"),o.children[0].textContent=a?this.getStaticEntityEmoji(a.getAgent().getType()):"",o.style.transformOrigin="0 0",o.style.position="absolute",o.style.top=O?"-.125ch":"-.075ch",o.style.left=O?".35ch":"0",o.style.display=s?"block":"none",o.style.willChange="transform",this.world.appendChild(o),o},qt.Growing,0),this.messageFn=new Promise(s=>this.resolveMessageFn=s),window.debug=()=>{pt=!pt,this.renderTiles()}}mount(t){this.target=t;const e=t.appendChild(document.createElement("div"));Pe(ri,{register:this.resolveMessageFn}).mount(e),this.world=t.appendChild(document.createElement("div")),this.world.className="scrollable",this.world.style.lineHeight=O?"1.86ch":"1ch",this.world.style.whiteSpace="nowrap",this.world.style.cursor="crosshair",this.world.style.userSelect="none",this.world.style.position="relative",this.world.style.fontFamily='"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji","Android Emoji","EmojiOne Mozilla","Twemoji Mozilla","Noto Emoji","Segoe UI Symbol",EmojiSymbols',this.world.style.backgroundColor="#000",O&&(this.world.style.letterSpacing="-0.7ch",this.world.style.wordSpacing="2.04ch"),this.renderTiles(),this.zoom();const{width:s,height:i}=this.world.getBoundingClientRect(),a=c.Instance.getBase().getTile();this.world.scrollLeft=a.getX()*this.xStep-s/2,this.world.scrollTop=a.getY()*this.yStep-i/2,this.rerender(0),this.registerEventHandlers(this.world)}zoom(){const t=(this.world.scrollLeft+this.world.clientWidth/2)/this.world.scrollWidth,e=(this.world.scrollTop+this.world.clientHeight/2)/this.world.scrollHeight;this.world.style.fontSize=`${this.fontSize}px`;const{width:s,height:i,x:a,y:o}=this.world.getBoundingClientRect(),l=this.world.scrollWidth,u=this.world.scrollHeight;this.xStep=l/this.surface.getWidth(),this.yStep=u/this.surface.getHeight(),this.offsetX=a,this.offsetY=o,this.world.scrollLeft=t*l-s/2,this.world.scrollTop=e*u-i/2}rerender(t){this.time+=t,this.surface.isDirty()&&this.renderTiles(),(this.surface.isDirty()||this.hasMoved)&&(this.renderStaticAgents(),this.renderAlertRanges());const e=this.surface.getEntities();for(let i of e){const a=Pa[i.getAgent().getType()];if(!this.getEntityEmoji(i)&&!a)continue;const o=this.pool.get(i);o.style.display=i.getAgent().isVisible()?"block":"none",a?a(this,i.getAgent(),o):o.style.transform=`translate(${i.getX()*this.xStep}px, ${i.getY()*this.yStep}px) rotate(${i.getRotation()}deg)`}this.surface.getDeletedEntities().forEach(i=>{const a=this.pool.free(i);a&&(a.style.display="none")}),this.renderSelection(),this.surface.markPristine()}showCoverage(){this._showCoverage=!0,this.renderTiles()}hideCoverage(){this._showCoverage=!1,this.renderTiles()}renderTiles(){const t=this.surface.getHeight();for(let e=0;e<t;e++){let s=this.rows[e];s||(s=document.createElement("div"),O&&(s.style.letterSpacing="-0.7ch"),this.rows[e]=s,this.world.appendChild(s));const i=this.surface.getRow(e).map(this.getEmoji).join("");s.innerHTML=i}this.renderCoverage()}renderStaticAgents(){const t=this.surface.getEntitiesForCategory(M.Player);for(let s of t){const i=s.getAgent();if(be(i)&&rt(i)===2){const a=this.scaledTilesPool.get(s);a.style.transform=`translate(${s.getX()*this.xStep}px, ${s.getY()*this.yStep}px) scale(2)`}}this.surface.getDeletedEntities().forEach(s=>{const i=this.scaledTilesPool.free(s);i&&(i.style.display="none")})}renderCoverage(){const t=pt||c.Instance.getIsBaseDestroyed();if(this.coverageMap||(this.coverageMap=document.createElement("div"),this.coverageMap.style.opacity="0.5",this.coverageMap.style.position="absolute",this.coverageMap.style.top="0",this.coverageMap.style.left=O?"-0.125ch":"0",O&&(this.coverageMap.style.letterSpacing="-0.7ch",this.coverageMap.style.wordSpacing="2.04ch"),this.world.appendChild(this.coverageMap)),this._showCoverage)this.coverageMap.style.display="block";else{this.coverageMap.style.display="none";return}const e=new Set;c.Instance.getDifficulty()===$.Easy&&c.Instance.getWaveController().getSpawnGroups().forEach(i=>i.getSpawnPoints()[0].getTiles().forEach(a=>e.add(a)));const s=this.surface.getHeight();for(let i=0;i<s;i++){let a=this.coverageRows[i];a||(a=document.createElement("div"),this.coverageRows[i]=a,this.coverageMap.appendChild(a));const o=this.surface.getRow(i).map(l=>{if(!l.isDiscovered()&&!t)return"&nbsp;";const u=l.isCoveredByTower();return e.has(l)?u?"\u2694\uFE0F":"\u{1F43E}":u?"\u{1F3AF}":"&nbsp;"}).join("");a.innerHTML=o}}renderSelection(){var i,a;const t=this.selectionPool.getUsed();let e=this.controller.getSelection();e.length===1&&(e=[]);const s=((a=(i=this.controller.getPlacable())==null?void 0:i.entity)==null?void 0:a.scale)||1;e.forEach((o,l)=>{const u=t.has(l)?t.get(l):this.selectionPool.get(l);u.style.transform=`translate(${o.getX()*this.xStep}px, ${o.getY()*this.yStep}px) scale(${s})`});for(let o=t.size-1;o>=e.length;o--){const l=this.selectionPool.free(o);l&&(l.style.display="none")}}renderAlertRanges(){const[t,e]=gt(c.Instance.getBase()),s=20*this.xStep,i=20*this.yStep,a=c.Instance.getIsStarted()?[]:c.Instance.getWaveController().getSpawnAlertRanges();a.forEach((o,l)=>{const u=o.getLength(),p=o.getCenter(),y=u/360;let g=this.alertRanges[l];if(!g){this.alertRanges[l]=g=document.createElementNS("http://www.w3.org/2000/svg","svg");const E=document.createElementNS("http://www.w3.org/2000/svg","circle");E.setAttribute("cx","50%"),E.setAttribute("cy","50%"),E.setAttribute("r","45%"),E.setAttribute("stroke","url(#alert)"),E.setAttribute("stroke-linecap","round"),E.setAttribute("fill","none"),g.appendChild(E);const v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("text-anchor","middle"),v.setAttribute("dominant-baseline","middle"),v.classList.add("alert"),v.innerHTML="\u26A0\uFE0F",g.appendChild(v),g.style.position="absolute",g.style.top=O?"-.125ch":"-.075ch",g.style.left=O?".35ch":"0",g.style.transformOrigin="50%",this.world.appendChild(g)}g.style.display="block",g.children[0].setAttribute("stroke-width",`${this.fontSize}`),g.children[1].style.transform=`translate(90%, 50%) rotate(-${p}deg)`;const f=s*.9*Math.PI;g.children[0].setAttribute("stroke-dasharray",`${f*y/2} ${f*(1-y)} ${f*y/2} 0`),g.style.width=`${s}px`,g.style.height=`${i}px`,g.style.transform=`translate(${t*this.xStep-s/2}px,${e*this.yStep-i/2}px) rotate(${p}deg)`});for(let o=a.length;o<this.alertRanges.length;o++)this.alertRanges[o].style.display="none"}unmount(){throw new Error("Method not implemented.")}getTime(){return this.time}canMove(t,e){if(pt||c.Instance.getIsBaseDestroyed())return!0;const i=this.getBBox(),a=c.Instance.getVisibilityController().getBBox();if(Math.abs(t)>Math.abs(e)){if(t<0&&i[0][0]<=a[0][0]||t>0&&i[1][0]>=a[1][0])return!1}else if(e<0&&i[0][1]<=a[0][1]||e>0&&i[1][1]>=a[1][1])return!1;return!0}registerEventHandlers(t){t.addEventListener("contextmenu",s=>(s.preventDefault(),!1));const e=(s,i,a)=>{pt||c.Instance.getIsBaseDestroyed()||(this.getBBox(),c.Instance.getVisibilityController().getBBox(),this.canMove(s,i)||a.preventDefault())};t.addEventListener("wheel",s=>{e(s.deltaX,s.deltaY,s)},{passive:!1}),t.addEventListener("mousedown",s=>{const i=Math.floor((s.pageX-this.offsetX+this.world.scrollLeft)/this.xStep),a=Math.floor((s.pageY-this.offsetY+this.world.scrollTop)/this.yStep);this.controller.mouseDown(i,a)}),t.addEventListener("mousemove",s=>{const i=Math.floor((s.pageX-this.offsetX+this.world.scrollLeft)/this.xStep),a=Math.floor((s.pageY-this.offsetY+this.world.scrollTop)/this.yStep);this.controller.mouseMove(i,a)}),t.addEventListener("mouseup",s=>{const i=Math.floor((s.pageX-this.offsetX+this.world.scrollLeft)/this.xStep),a=Math.floor((s.pageY-this.offsetY+this.world.scrollTop)/this.yStep);this.controller.mouseUp(i,a)}),window.addEventListener("keydown",s=>{this.controller.keyDown(s.key),s.preventDefault()}),window.addEventListener("keyup",s=>{this.controller.keyUp(s.key),s.preventDefault()})}move({x:t=0,y:e=0,zoom:s}){(t||e)&&this.canMove(t,e)&&(this.world.scrollLeft+=t*this.fontSize/2,this.world.scrollTop+=e*this.fontSize/2),s&&(s<0?this.fontSize=Math.max($a,this.fontSize*.9):this.fontSize=Math.min(Oa,this.fontSize*1.1),this.zoom(),this.hasMoved=!0)}getStaticEntityEmoji(t){switch(t){case h.Tower:return"\u{1F5FC}";case h.Wall:return"\u{1F9F1}";case h.Mortar:return"\u{1F6F0}\uFE0F";case h.Flamethrower:return"\u{1F9EF}";case h.Railgun:return"\u{1F321}\uFE0F";case h.ElectricFence:return"\u26A1";case h.Fence:return"\u{1F945}";case h.Freezer:return"\u2744\uFE0F";case h.Base:return"\u26FA";case h.Tree:return"\u{1F332}";case h.Rock:return"\u{1FAA8}";case h.Radar:return"\u{1F4E1}";case h.PowerPlant:return"\u{1F3ED}";case h.None:return"\u274C";case h.Armory:return"\u{1F3F0}";case h.Market:return"\u{1F3EA}";case h.SpeedBeacon:return"\u23F0";case h.DamageBeacon:return"\u{1F6A8}";case h.Laser:return"\u{1F52D}";default:return"\u2753"}}getEntityEmoji(t){switch(t.getAgent().getType()){case h.Slime:return"\u{1F41E}";case h.Bullet:case h.Rocket:return"\u25AA";case h.Rail:case h.LaserBeam:return"\u2B1B";case h.Flame:return"\u{1F525}";case h.Shockwave:return"\u{1F300}";case h.Runner:return"\u{1FAB3}";case h.Flier:return"\u{1F41D}";case h.Tank:return"\u{1F980}";default:return""}}getBBox(){const t=this.world.scrollTop/this.yStep,e=this.world.scrollLeft/this.xStep,s=this.world.clientHeight/this.yStep,i=this.world.clientWidth/this.xStep;return[[e,t],[e+i,t+s]]}}const tt="atlas";var q=(n=>(n.Grass="atlas4.png",n.Sand="atlas7.png",n.Water="atlas10.png",n.WaterAlt="atlas11.png",n.Tree="atlas8.png",n.Rock="atlas9.png",n.Ice="atlas2.png",n.Snow="atlas3.png",n.Dirt="atlas1.png",n.Stone="atlas12.png",n.Spore="atlas13.png",n.Up="atlas14.png",n.Left="atlas15.png",n.Down="atlas16.png",n.Right="atlas17.png",n.UpRight="atlas18.png",n.UpLeft="atlas19.png",n.DownLeft="atlas20.png",n.DownRight="atlas21.png",n.Multi="atlas22.png",n.ActiveCoverage="atlas23.png",n.Coverage="atlas24.png",n.Alert="atlas25.png",n.Fence="atlas26.png",n.ElectricFence="atlas27.png",n.Entity="atlas28.png",n.Unknown="atlas29.png",n.Bridge="atlas5.png",n.None="atlas0.png",n))(q||{});const Ua={[d.Grass]:"atlas4.png",[d.Sand]:"atlas7.png",[d.Water]:"atlas10.png",[d.Ice]:"atlas2.png",[d.Snow]:"atlas3.png",[d.Dirt]:"atlas1.png",[d.Tree]:"atlas8.png",[d.Rock]:"atlas9.png",[d.Stone]:"atlas12.png",[d.Spore]:"atlas13.png",[d.Bridge]:"atlas5.png"},$e=new ut;$e.name="Floor";const et=new ut;et.name="Base";const St=new ut;St.name="Projectiles";const dt=new ut;dt.name="Towers";const Nt=new ut;Nt.name="UI";const Wa=[$e,et,St,dt,Nt],m=32,ke="buildings",Ha="buildings0.png",ja=new Map([[h.Base,"buildings0.png"],[h.Armory,"buildings1.png"],[h.PowerPlant,"buildings2.png"],[h.Radar,"buildings3.png"],[h.Market,"buildings4.png"],[h.DamageBeacon,"buildings5.png"],[h.SpeedBeacon,"buildings6.png"],[h.Freezer,"buildings12.png"]]);class oi extends Q{constructor(t,e){var s;super(e.resources[ke].spritesheet.textures[(s=ja.get(t.getType()))!=null?s:Ha]),this.data=t}sync(){this.position.set(this.data.entity.getX()*m,this.data.entity.getY()*m),this.angle=this.data.entity.getRotation()}}r(oi,"layer",et);const fs=new Map([[h.Armory,["buildings","buildings1.png"]],[h.PowerPlant,["buildings","buildings2.png"]],[h.Radar,["buildings","buildings3.png"]],[h.Market,["buildings","buildings4.png"]],[h.DamageBeacon,["buildings","buildings5.png"]],[h.SpeedBeacon,["buildings","buildings6.png"]],[h.Freezer,["buildings","buildings12.png"]],[h.Fence,[tt,q.Fence]],[h.Wall,["buildings","buildings13.png"]],[h.ElectricFence,[tt,q.ElectricFence]],[h.Tower,["turret","turret0.png"]],[h.Flamethrower,["flamethrower","flamethrower0.png"]],[h.Mortar,["mortar","mortar0.png"]],[h.Laser,["laser","laser0.png"]],[h.Railgun,["railgun","railgun0.png"]],[h.None,[tt,q.None]]]);class li extends Q{constructor(t,e){const s=t.getPlaceable().entityType;if(!fs.has(s))throw new Error(`Missing blueprint sprite for ${s}`);const[i,a]=fs.get(s);super(e.resources[i].spritesheet.textures[a]),this.data=t,s===h.None&&this.scale.set(t.getScale()),this.alpha=.7,this.position.set(this.data.entity.getX()*m,this.data.entity.getY()*m)}sync(){}}r(li,"layer",et);const Ut="projectiles",Wt="projectiles1.png",ms=20;class Va extends Q{constructor(){super(...arguments);r(this,"speed",0);r(this,"lifetime",0);r(this,"direction",0)}}class hi extends Me{constructor(t,e){super(ms,{position:!0,scale:!0,rotation:!0,alpha:!0}),this.data=t;for(let s=0;s<ms;s++){const i=new Va(e.resources[Ut].spritesheet.textures[Wt]);i.anchor.set(.5),i.scale.set(1+Math.random()*.3),i.speed=(4+Math.random()*2)*.0017,i.alpha=.8,i.lifetime=Math.floor(Math.random()*25),i.x=this.data.sourceX*m,i.y=this.data.sourceY*m,i.direction=(this.data.entity.getRotation()+20-Math.random()*40)*Math.PI/180,this.addChild(i)}}sync(t){this.children.forEach(e=>{e.x+=Math.sin(e.direction)*e.speed*t*m,e.y+=Math.cos(e.direction)*e.speed*t*m,e.lifetime+=1,e.lifetime>25&&(this.data.renderData.update?(e.lifetime=0,e.x=this.data.sourceX*m,e.y=this.data.sourceY*m,e.direction=(this.data.entity.getRotation()+20-Math.random()*40)*Math.PI/180,e.alpha=.8):(e.lifetime=Math.floor(Math.random()*25),e.alpha=0))}),this.data.renderData.update=!1}}r(hi,"layer",St);const Ga="explosion",za=.2;class Ht extends Et{constructor(t,e,s,i=1){super(Object.values(t.resources[Ga].spritesheet.textures)),this.anchor.set(.5),this.animationSpeed=za,this.loop=!1,this.position.set(e*m,s*m),this.scale.set(i),dt.addChild(this),this.onComplete=()=>{dt.removeChild(this)},this.play()}}const Ka="flier",qa=.2;class ci extends Et{constructor(e,s){super(Object.values(s.resources[Ka].spritesheet.textures));r(this,"flames",[]);this.data=e,this.loader=s,this.anchor.set(.5),this.animationSpeed=qa,this.play(),this.on("removed",()=>new Ht(s,e.entity.getX()+.5,e.entity.getY()+.5))}sync(){this.position.set((this.data.entity.getX()+.5)*m,(this.data.entity.getY()+.5)*m),this.angle=this.data.entity.getRotation();const e=m/2;if(this.flames.forEach(s=>{s.angle=-this.data.entity.getRotation(),s.position.set(Math.random()*e-e/2,Math.random()*e-e/2)}),this.data.getStatus()===P.OnFire&&!this.flames.length){this.tint=14833698;for(let s=0;s<2;s++){const i=new Q(this.loader.resources[Ut].spritesheet.textures[Wt]);i.alpha=.8,i.anchor.set(.5),i.position.set(Math.random()*e-e/2,Math.random()*e-e/2),this.addChild(i),this.flames.push(i)}}else this.data.getStatus()!==P.OnFire&&this.flames.length&&(this.tint=16777215,this.removeChildren(),this.flames=[])}}r(ci,"layer",et);const Za="projectiles",Qa="projectiles3.png",ve=16;class ui extends Es{constructor(e,s){super(s.resources[Za].spritesheet.textures[Qa],ve,ve);r(this,"tileOffset",0);this.data=e,this.pivot={x:ve/2,y:0}}sync(){this.tilePosition.y=this.tileOffset,this.tileOffset+=.5;const e=this.data.entity.getX(),s=this.data.entity.getY(),i=Math.sqrt((e-this.data.targetX)**2+(s-this.data.targetY)**2);this.height=i*m,this.alpha=Math.min(1,1-this.data.time/te+.1),this.position.set(this.data.entity.getX()*m,this.data.entity.getY()*m),this.angle=this.data.entity.getRotation()-90}}r(ui,"layer",St);const Ja="projectiles",to="projectiles4.png",Ee=16;class di extends Es{constructor(t,e){super(e.resources[Ja].spritesheet.textures[to],Ee,Ee),this.data=t,this.pivot={x:Ee/2,y:0}}sync(){const t=this.data.entity.getX(),e=this.data.entity.getY(),s=Math.sqrt((t-this.data.targetX)**2+(e-this.data.targetY)**2);this.height=s*m,this.alpha=Math.min(1,1-this.data.time/Le+.1),this.position.set(this.data.entity.getX()*m,this.data.entity.getY()*m),this.angle=this.data.entity.getRotation()-90}}r(di,"layer",St);const eo="regular",so=.1;class gi extends Et{constructor(e,s){super(Object.values(s.resources[eo].spritesheet.textures));r(this,"flames",[]);this.data=e,this.loader=s,this.anchor.set(.5),this.animationSpeed=so,this.on("removed",()=>new Ht(s,e.entity.getX()+.5,e.entity.getY()+.5))}sync(){this.position.set((this.data.entity.getX()+.5)*m,(this.data.entity.getY()+.5)*m),this.angle=this.data.entity.getRotation(),this.data.AI.isBusy()===this.playing&&(this.playing?this.stop():this.play());const e=m/2;if(this.flames.forEach(s=>{s.angle=-this.data.entity.getRotation(),s.position.set(Math.random()*e-e/2,Math.random()*e-e/2)}),this.data.getStatus()===P.OnFire&&!this.flames.length){this.tint=14833698;for(let s=0;s<2;s++){const i=new Q(this.loader.resources[Ut].spritesheet.textures[Wt]);i.alpha=.8,i.anchor.set(.5),i.position.set(Math.random()*e-e/2,Math.random()*e-e/2),this.addChild(i),this.flames.push(i)}}else this.data.getStatus()!==P.OnFire&&this.flames.length&&(this.tint=16777215,this.removeChildren(),this.flames=[])}}r(gi,"layer",et);const io="runner",no=.1;class pi extends Et{constructor(e,s){super(Object.values(s.resources[io].spritesheet.textures));r(this,"flames",[]);this.data=e,this.loader=s,this.anchor.set(.5),this.animationSpeed=no,this.on("removed",()=>new Ht(s,e.entity.getX()+.5,e.entity.getY()+.5))}sync(){this.position.set((this.data.entity.getX()+.5)*m,(this.data.entity.getY()+.5)*m),this.angle=this.data.entity.getRotation(),this.data.AI.isBusy()===this.playing&&(this.playing?this.stop():this.play());const e=m/2;if(this.flames.forEach(s=>{s.angle=-this.data.entity.getRotation(),s.position.set(Math.random()*e-e/2,Math.random()*e-e/2)}),this.data.getStatus()===P.OnFire&&!this.flames.length){this.tint=14833698;for(let s=0;s<2;s++){const i=new Q(this.loader.resources[Ut].spritesheet.textures[Wt]);i.alpha=.8,i.anchor.set(.5),i.position.set(Math.random()*e-e/2,Math.random()*e-e/2),this.addChild(i),this.flames.push(i)}}else this.data.getStatus()!==P.OnFire&&this.flames.length&&(this.tint=16777215,this.removeChildren(),this.flames=[])}}r(pi,"layer",et);const ro="projectiles",ao="projectiles0.png",oo=new Map([[h.Bullet,"projectiles0.png"],[h.Flame,"projectiles1.png"],[h.Rocket,"projectiles2.png"],[h.Shockwave,"projectiles5.png"]]);class se extends Q{constructor(t,e){var s;super(e.resources[ro].spritesheet.textures[(s=oo.get(t.getType()))!=null?s:ao]),this.data=t,this.pivot={x:8,y:8}}sync(){this.position.set(this.data.entity.getX()*m,this.data.entity.getY()*m),this.angle=this.data.entity.getRotation()}}r(se,"layer",St);const lo="tank",ho=.1;class fi extends Et{constructor(e,s){super(Object.values(s.resources[lo].spritesheet.textures));r(this,"flames",[]);this.data=e,this.loader=s,this.anchor.set(.5),this.animationSpeed=ho,this.on("removed",()=>new Ht(s,e.entity.getX()+.5,e.entity.getY()+.5))}sync(){this.position.set((this.data.entity.getX()+.5)*m,(this.data.entity.getY()+.5)*m),this.angle=this.data.entity.getRotation(),this.data.AI.isBusy()===this.playing&&(this.playing?this.stop():this.play());const e=m/2;if(this.flames.forEach(s=>{s.angle=-this.data.entity.getRotation(),s.position.set(Math.random()*e-e/2,Math.random()*e-e/2)}),this.data.getStatus()===P.OnFire&&!this.flames.length){this.tint=14833698;for(let s=0;s<2;s++){const i=new Q(this.loader.resources[Ut].spritesheet.textures[Wt]);i.alpha=.8,i.anchor.set(.5),i.position.set(Math.random()*e-e/2,Math.random()*e-e/2),this.addChild(i),this.flames.push(i)}}else this.data.getStatus()!==P.OnFire&&this.flames.length&&(this.tint=16777215,this.removeChildren(),this.flames=[])}}r(fi,"layer",et);const co=new Map([[h.Tower,"turret"],[h.Flamethrower,"flamethrower"],[h.Laser,"laser"],[h.Mortar,"mortar"],[h.Railgun,"railgun"]]),uo=.1,go=.6,po="buildings8.png",fo="buildings9.png",mo="buildings10.png",yo="buildings11.png",ys=(n,t)=>n?t?po:fo:t?mo:yo;class ft extends Q{constructor(e,s){super(s.resources[ke].spritesheet.textures[ys(e.isSpeedBoosted(),e.isDamageBoosted())]);r(this,"turret");this.data=e,this.loader=s;const[i,a]=gt(e);this.position.set(i*m,a*m),this.pivot={x:m,y:m},this.createTurret()}createTurret(){const e=co.get(this.data.getType());this.turret=new Et(Object.values(this.loader.resources[e].spritesheet.textures)),this.turret.position.set(this.x,this.y),this.turret.pivot={x:m,y:m},this.turret.animationSpeed=uo,this.turret.loop=!1,this.turret.onComplete=()=>{this.turret.gotoAndStop(0)},dt.addChild(this.turret),this.on("removed",()=>dt.removeChild(this.turret))}sync(e,s){s&&(this.texture=this.loader.resources[ke].spritesheet.textures[ys(this.data.isSpeedBoosted(),this.data.isDamageBoosted())]),this.turret.angle=Ui(this.turret.angle,this.data.entity.getRotation(),go*e),this.data.renderData.fired&&(this.data.renderData.fired=!1,this.turret.play())}}r(ft,"layer",et);class mi extends se{constructor(t,e){super(t,e),this.on("removed",()=>new Ht(e,t.entity.getX(),t.entity.getY(),2))}}r(mi,"layer",dt);const wo=n=>{n.add("runner","/open-td/animations/runner.json"),n.add("regular","/open-td/animations/regular.json"),n.add("flier","/open-td/animations/flier.json"),n.add("tank","/open-td/animations/tank.json"),n.add("buildings","/open-td/tiles/buildings.json"),n.add("turret","/open-td/animations/turret.json"),n.add("flamethrower","/open-td/animations/flamethrower.json"),n.add("laser","/open-td/animations/laser.json"),n.add("mortar","/open-td/animations/mortar.json"),n.add("railgun","/open-td/animations/railgun.json"),n.add("projectiles","/open-td/tiles/projectiles.json"),n.add("explosion","/open-td/animations/explosion.json")},vo={[h.Runner]:pi,[h.Slime]:gi,[h.Flier]:ci,[h.Tank]:fi,[h.Tower]:ft,[h.Flamethrower]:ft,[h.Laser]:ft,[h.Mortar]:ft,[h.Railgun]:ft,[h.Bullet]:se,[h.Flame]:hi,[h.Rocket]:mi,[h.Shockwave]:se,[h.LaserBeam]:ui,[h.Rail]:di,[h.Fence]:null,[h.Wall]:null,[h.ElectricFence]:null,[h.Blueprint]:li},Eo={1:[[0,-1],[-1,0],[0,1],[1,0],[1,-1],[-1,-1],[-1,1],[1,1]],2:[[0,-1],[-1,0],[0,2],[2,0],[2,-1],[-1,-1],[-1,2],[2,2]]},zt=8,yi=new Set([d.Fence,d.Wall,d.ElectricFence]);class So{constructor(t,e,s){this.loader=t,this.tilemap=e,this.surface=s,t.add("fences","/open-td/tiles/fenceCombined.json"),t.add("wall","/open-td/tiles/bigWall.json")}getWallSprite(t,e){switch(t){case h.Fence:return this.loader.resources.fences.textures[`fenceCombined${e}.png`];case h.ElectricFence:return this.loader.resources.fences.textures[`fenceCombined${9+e}.png`];case h.Wall:return this.loader.resources.wall.textures[`bigWall${e}.png`];default:throw new Error("unknown wall type")}}render(t){const e=t.getStaticEntity().getAgent(),s=e.getType(),i=rt(e);let a=0,o=0,l=0,u=!1;Eo[i].forEach(([p,y],g)=>{if(g>3&&(u||p===o||y===l))return;const f=this.surface.getTile(t.getX()+p,t.getY()+y);f&&yi.has(f.getType())&&rt(f.getStaticEntity().getAgent())===i&&(g<=3&&(o&&p||l&&y?u=!0:(o=o||p,l=l||y)),this.tilemap.tile(this.getWallSprite(s,g),t.getX()*m-zt*i,t.getY()*m-zt*i),a++)}),a<2&&this.tilemap.tile(this.getWallSprite(s,8),t.getX()*m-zt*i,t.getY()*m-zt*i)}}class Mo extends Q{constructor(t,e,s){super(s),this.offset=t,this.path=e;const{x:i,y:a}=this.path.getCoordinates(this.offset%this.path.getLength());this.position.set(i*m,a*m)}move(){this.offset+=.1;const{x:t,y:e}=this.path.getCoordinates(this.offset%this.path.getLength());this.position.set(t*m,e*m)}}class bo{constructor(t,e){r(this,"coverageContainer");r(this,"pathContainer");r(this,"towers",new Map);r(this,"hoveredTile");r(this,"visible",!1);this.loader=t,this.surface=e,this.coverageContainer=new Me(void 0,{uvs:!0},void 0,!0),$e.addChild(this.coverageContainer),this.pathContainer=new Me(void 0,{position:!0},void 0,!0),Nt.addChild(this.pathContainer)}show(){this.visible=!0,this.render()}hide(){this.visible=!1,this.coverageContainer.removeChildren(),this.pathContainer.removeChildren()}render(){!this.visible||(this.renderCoverage(),c.Instance.getDifficulty()===$.Easy&&this.renderPaths())}renderCoverage(){this.coverageContainer.removeChildren(),this.towers.clear(),this.hoveredTile=void 0;const t=this.surface.getHeight();for(let e=0;e<t;e++)this.surface.getRow(e).forEach(s=>{const i=s.getTowers();if(i.length===0||!s.isDiscovered())return;const a=new Q(this.loader.resources[tt].textures[q.Coverage]);a.alpha=Math.min(.1+.2*i.length,.8),a.position.set(s.getX()*m,s.getY()*m),this.coverageContainer.addChild(a),i.forEach(o=>{const l=this.towers.get(o.getTile().getHash())||[];l.push(a),this.towers.set(o.getTile().getHash(),l)})})}renderPaths(){this.pathContainer.removeChildren();const t=[];c.Instance.getWaveController().getSpawnGroups().filter(e=>!e.isExposed()).forEach(e=>t.push(...e.getSpawnPoints())),t.forEach((e,s)=>{const i=this.slicePath(e),a=Math.max(1,Math.floor(i.getLength()/5));for(let o=0;o<a;o++)this.pathContainer.addChild(new Mo(s*2+o*5,i,this.loader.resources[tt].textures[q.Entity]))})}slicePath(t){let e,s;for(let i=0;i<t.getLength();i++){const a=t.getTile(i);if(a.isDiscovered()||(e=i+1),a.hasStaticEntity()&&De.has(a.getStaticEntity().getAgent().getType())){s=i;break}}return t.slice(e,s)}update(){var i,a;if(!this.visible)return;c.Instance.getIsStarted()?this.pathContainer.removeChildren():this.pathContainer.children.forEach(o=>o.move());const[t,e]=c.Instance.getController().getMouse(2),s=this.surface.getTile(t,e);s!==this.hoveredTile&&(this.hoveredTile&&((i=this.towers.get(this.hoveredTile.getHash()))==null||i.forEach(o=>{o.texture=this.loader.resources[tt].textures[q.Coverage]})),s&&((a=this.towers.get(s.getHash()))==null||a.forEach(o=>{o.texture=this.loader.resources[tt].textures[q.ActiveCoverage]})),this.hoveredTile=s)}}const Ze=class{constructor(t){r(this,"container");r(this,"alertSymbols",[]);r(this,"time",0);this.loader=t,this.container=new ut,Nt.addChild(this.container)}render(t,e){this.time=0,this.alertSymbols=[],this.container.removeChildren(),this.container.alpha=1;const[s,i]=t,a=Math.PI/128;e.forEach(o=>{const[l,u]=o.getRange(),p=new ut,y=new Ss;y.lineStyle({width:10,color:267386880,cap:Ri.ROUND,alpha:.8,alignment:.5}),y.arc(s*m,i*m,10*m,l*Math.PI/180+a,u*Math.PI/180-a);const g=new Q(this.loader.resources[tt].textures[q.Alert]);g.anchor.set(.5);const f=o.getCenter()*Math.PI/180;g.position.set((s+Math.cos(f)*9.2)*m,(i+Math.sin(f)*9.2)*m),this.alertSymbols.push(g),p.addChild(y,g),this.container.addChild(p)})}update(t,e){this.container.alpha<=0||((this.time>Ze.DISPLAY_DURATION||e)&&(this.container.alpha-=t/500),this.alertSymbols.forEach(s=>{s.alpha=Math.abs(Math.cos(this.time/300))}),this.time+=t)}};let Qt=Ze;r(Qt,"DISPLAY_DURATION",10*1e3);let Kt=!1;const ws=20,_o=3,To=.5;Fi.use32bitIndex=!0;class wi{constructor(t,e){r(this,"messageFn");r(this,"resolveMessageFn");r(this,"target");r(this,"app");r(this,"viewport");r(this,"tilemap");r(this,"sprites",new Map);r(this,"selection");r(this,"loader");r(this,"wallRenderer");r(this,"coverageRenderer");r(this,"alertRenderer");r(this,"x",0);r(this,"y",0);r(this,"scale",1);r(this,"width",0);r(this,"height",0);r(this,"time",0);r(this,"showMessage",async(...t)=>(await this.messageFn)(...t));this.surface=t,this.controller=e,this.messageFn=new Promise(s=>this.resolveMessageFn=s),this.tilemap=new Bi,this.loader=new Li,this.loader.add(tt,"/open-td/tiles/atlas.json"),this.wallRenderer=new So(this.loader,this.tilemap,this.surface),wo(this.loader),this.loader.load(),window.debug=()=>{Kt=!Kt,this.renderTilemap()}}mount(t){this.target=t,this.app=new Yi({width:window.innerWidth,height:window.innerHeight}),t.appendChild(this.app.view),this.width=this.surface.getWidth()*m,this.height=this.surface.getHeight()*m,this.viewport=new Xi({screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:this.width,worldHeight:this.height,interaction:this.app.renderer.plugins.interaction}).clamp({direction:"all",underflow:"center"}).drag({wheel:!0,clampWheel:!0,pressDrag:!1}).addListener("moved",({type:i})=>{i!=="animate"&&(this.x=this.viewport.center.x,this.y=this.viewport.center.y)}),this.app.stage.addChild(this.viewport),this.viewport.addChild(this.tilemap,...Wa),this.coverageRenderer=new bo(this.loader,this.surface),this.alertRenderer=new Qt(this.loader),this.selection=new Ss,Nt.addChild(this.selection),this.loader.loading?this.loader.onComplete.add(()=>this.renderTilemap()):this.renderTilemap();const e=t.appendChild(document.createElement("div"));Pe(ri,{register:this.resolveMessageFn}).mount(e);const s=c.Instance.getBase().getTile();this.x=s.getX()*m,this.y=s.getY()*m,this.viewport.animate({time:0,position:{x:this.x,y:this.y}}),this.registerEventHandlers()}renderTilemap(){this.tilemap.clear();const t=Kt||c.Instance.getIsBaseDestroyed(),e=this.loader.resources[tt],s=this.surface.getHeight(),i=[];for(let l=0;l<s;l++)this.surface.getRow(l).forEach(u=>{if(!t){if(u.getDiscoveryStatus()===L.Undiscovered)return;if(u.getDiscoveryStatus()===L.Pending){this.tilemap.tile(e.textures[q.Unknown],u.getX()*m,u.getY()*m);return}}let p=Ua[u.getBaseType()];p&&(this.tilemap.tile(e.textures[p],u.getX()*m,u.getY()*m),u.getBaseType()===d.Water&&this.tilemap.tileAnimX(32,2)),u.hasStaticEntity()&&(u.getType()===d.Tree?this.tilemap.tile(e.textures[q.Tree],u.getX()*m,u.getY()*m):u.getType()===d.Rock?this.tilemap.tile(e.textures[q.Rock],u.getX()*m,u.getY()*m):yi.has(u.getType())&&u.isStaticEntityRoot()&&i.push(u))});i.forEach(l=>this.wallRenderer.render(l)),this.coverageRenderer.render();const a=gt(c.Instance.getBase()),o=c.Instance.getWaveController().getSpawnAlertRanges();this.alertRenderer.render(a,o)}rerender(t){if(this.loader.loading)return;this.time+=t;const e=Kt||c.Instance.getIsBaseDestroyed(),s=this.surface.isDirty();s&&this.renderTilemap(),this.app.renderer.plugins.tilemap.tileAnim[0]+=t/500,this.renderSelection();const i=this.surface.getEntities();for(let o of i){let l=this.sprites.get(o.getId());if(!l){const u=vo[o.getAgent().getType()];if(u===null)continue;const p=u||oi;l=new p(o.getAgent(),this.loader),p.layer.addChild(l),this.sprites.set(o.getId(),l)}o.getAgent().isVisible()||e?(l.sync(t,s),l.visible=!0):l.visible=!1}this.surface.getDeletedEntities().forEach(o=>{const l=this.sprites.get(o.getId());l&&(this.sprites.delete(o.getId()),l.constructor.layer.removeChild(l))}),this.coverageRenderer.update(),this.alertRenderer.update(t,c.Instance.getIsStarted()),this.surface.markPristine()}renderSelection(){var e,s;const t=m*(((s=(e=this.controller.getPlacable())==null?void 0:e.entity)==null?void 0:s.scale)||1);if(this.selection.clear(),this.selection.lineStyle(2,0),this.controller.isMouseDown())this.controller.getSelection().forEach(i=>{this.selection.drawRect(i.getX()*m,i.getY()*m,t,t)});else{const[i,a]=this.controller.getMouse();this.selection.drawRect(i*m,a*m,t,t)}}showCoverage(){this.coverageRenderer.show()}hideCoverage(){this.coverageRenderer.hide()}unmount(){throw new Error("Method not implemented.")}getTime(){return this.time}registerEventHandlers(){this.target.addEventListener("contextmenu",t=>(t.preventDefault(),!1)),this.viewport.addListener("mousedown",t=>{const e=Math.floor((t.data.global.x/this.viewport.scale.x+this.viewport.left)/m),s=Math.floor((t.data.global.y/this.viewport.scale.y+this.viewport.top)/m);this.controller.mouseDown(e,s)}),this.viewport.addListener("mousemove",t=>{const e=Math.floor((t.data.global.x/this.viewport.scale.x+this.viewport.left)/m),s=Math.floor((t.data.global.y/this.viewport.scale.y+this.viewport.top)/m);this.controller.mouseMove(e,s)}),this.viewport.addListener("mouseup",t=>{const e=Math.floor((t.data.global.x/this.viewport.scale.x+this.viewport.left)/m),s=Math.floor((t.data.global.y/this.viewport.scale.y+this.viewport.top)/m);this.controller.mouseUp(e,s)}),window.addEventListener("keydown",t=>{this.controller.keyDown(t.key),t.preventDefault()}),window.addEventListener("keyup",t=>{this.controller.keyUp(t.key),t.preventDefault()})}move({x:t=0,y:e=0,zoom:s}){s&&(s<0?this.scale=Math.max(To,this.scale*.9):this.scale=Math.min(_o,this.scale*1.1));const i=this.viewport.worldScreenWidth/2,a=this.viewport.worldScreenHeight/2;(t>0&&this.x<this.width-i||t<0&&this.x>i)&&(this.x+=t*ws/this.scale),(e>0&&this.y<this.height-a||e<0&&this.y>a)&&(this.y+=e*ws/this.scale),this.viewport.animate({time:200,position:{x:this.x,y:this.y},scale:this.scale})}}const Io=(n,t,e)=>{var s;return((s=Object.entries(n).find(([i,a])=>t===a))==null?void 0:s[0])||e},Ao=(n,t,e)=>Object.values(n).find(s=>s===t)||e,Jt={emojiRenderer:ai,pixiRenderer:wi},Co=(n,t)=>n==="renderer"?t in Jt?Jt[t]:Jt.emojiRenderer:n==="difficulty"?Ao($,t):t,xo=(n,t)=>n==="renderer"?Io(Jt,t,"emojiRenderer"):t,ko={settings:Co},Po={settings:xo},vi=n=>{let t;try{t=localStorage.getItem(n)}catch{return null}if(!t)return null;try{return JSON.parse(t,ko[n])}catch{return null}},Do=(n,t)=>{const e=vi(n)||{},s=JSON.stringify({...e,...t},Po[n]);try{localStorage.setItem(n,s)}catch(i){console.warn("Failed to store data",i)}};const Ro={},Fo={class:"key-grid"};function Bo(n,t){return S(),_("div",Fo,[Pi(n.$slots,"default",{},void 0,!0)])}const Se=J(Ro,[["render",Bo],["__scopeId","data-v-ad6fcae2"]]),ce=n=>(Rt("data-v-1cf0af5a"),n=n(),Ft(),n),Lo=ce(()=>w("h3",null,"Build menu",-1)),Yo={class:"flex"},Xo=ce(()=>w("h3",null,"Building",-1)),Oo={class:"flex flex-justify"},$o={class:"key-combination"},No={class:"key-combination"},Uo=ce(()=>w("h3",null,"Moving",-1)),Wo={class:"flex flex-justify"},Ho=ce(()=>w("h3",null,"Zooming",-1)),jo={class:"flex"},Vo=Z({__name:"ControlsList",setup(n){return(t,e)=>(S(),_(nt,null,[Lo,w("div",Yo,[C(F,{char:"b"})]),Xo,w("div",Oo,[C(Zt,{button:"left"}),D(" / "),w("span",$o,[C(F,{char:"\u21E7"}),D(" + "),C(Zt,{button:"left"})]),D(" / "),w("span",No,[C(F,{char:"\u2318"}),D(" + "),C(Zt,{button:"left"})])]),Uo,w("div",Wo,[C(Se,null,{default:ge(()=>[C(F,{char:"w",area:"up"}),C(F,{char:"a",area:"left"}),C(F,{char:"s",area:"down"}),C(F,{char:"d",area:"right"})]),_:1}),D(" / "),C(Se,null,{default:ge(()=>[C(F,{char:"z",area:"up"}),C(F,{char:"q",area:"left"}),C(F,{char:"s",area:"down"}),C(F,{char:"d",area:"right"})]),_:1}),D(" / "),C(Se,null,{default:ge(()=>[C(F,{char:"\u2191",area:"up"}),C(F,{char:"\u2190",area:"left"}),C(F,{char:"\u2193",area:"down"}),C(F,{char:"\u2192",area:"right"})]),_:1})]),Ho,w("div",jo,[C(F,{char:"-"}),C(F,{char:"+"})])],64))}});const Go=J(Vo,[["__scopeId","data-v-1cf0af5a"]]),Ei=n=>(Rt("data-v-b3206287"),n=n(),Ft(),n),zo={class:"wrapper"},Ko=Ei(()=>w("h1",null,"Open Tower Defense \u{1F5FC}",-1)),qo={class:"menu"},Zo={class:"menu-main"},Qo={class:"menu-main-inner"},Jo=["value"],tl={class:"difficulty-description"},el=Ei(()=>w("button",{type:"submit"},"Start!",-1)),sl={class:"menu-controls-inner"},il={class:"menu-settings-inner"},nl=["value"],rl=Z({__name:"MainMenu",props:{onPlay:null},setup(n){const t=n,e=[{label:"Emoji renderer",value:ai},{label:"Pixi renderer",value:wi}],s=vi("settings"),i=T(0),a=T(""),o=T(null),l=T((s==null?void 0:s.difficulty)||$.Easy),u=T(s&&e.find(({value:g})=>g===s.renderer)||e[0]),p=g=>{var f;if(g===i.value){i.value=0;return}i.value=g,i.value===1&&((f=o.value)==null||f.focus())},y=g=>{g.preventDefault(),Do("settings",{renderer:u.value.value,difficulty:l.value}),t.onPlay(a.value,l.value,u.value.value)};return(g,f)=>(S(),_("div",zo,[Ko,w("div",qo,[w("div",Zo,[w("div",Qo,[w("button",{onClick:f[0]||(f[0]=E=>p(1))},"Play"),w("button",{onClick:f[1]||(f[1]=E=>p(2))},"Controls"),w("button",{onClick:f[2]||(f[2]=E=>p(3))},"Settings")])]),w("div",{class:U({"menu-play":!0,"menu--hidden":i.value!==1})},[w("form",{onSubmit:y,class:"menu-play-inner"},[w("label",null,[D(" Which planet? "),pe(w("input",{ref_key:"seedInput",ref:o,"onUpdate:modelValue":f[3]||(f[3]=E=>a.value=E)},null,512),[[Di,a.value]])]),w("label",null,[D(" Difficulty "),pe(w("select",{"onUpdate:modelValue":f[4]||(f[4]=E=>l.value=E)},[(S(!0),_(nt,null,Dt(x(ts),({label:E},v)=>(S(),_("option",{value:v},R(E),9,Jo))),256))],512),[[Je,l.value]])]),w("p",tl,R(x(ts)[l.value].description),1),el],32)],2),w("div",{class:U({"menu-controls":!0,"menu--hidden":i.value!==2})},[w("div",sl,[C(Go)])],2),w("div",{class:U({"menu-settings":!0,"menu--hidden":i.value!==3})},[w("div",il,[w("label",null,[D(" Renderer "),pe(w("select",{"onUpdate:modelValue":f[5]||(f[5]=E=>u.value=E)},[(S(),_(nt,null,Dt(e,E=>w("option",{value:E},R(E.label),9,nl)),64))],512),[[Je,u.value]])])])],2)])]))}});const al=J(rl,[["__scopeId","data-v-b3206287"]]),ol=Z({__name:"App",setup(n){const t=T(0),e=T(),s=T(),i=T(),a=(o,l,u)=>{t.value=1,e.value=o,s.value=l,i.value=u};return(o,l)=>(S(),_(nt,null,[t.value==0?(S(),At(al,{key:0,onPlay:a})):Y("",!0),t.value==1?(S(),At(Ma,{key:1,seed:e.value,difficulty:s.value,renderer:i.value},null,8,["seed","difficulty","renderer"])):Y("",!0)],64))}});Pe(ol).mount("#app");
